import{a7 as o,d as G,da as D,q as f,s as b,c as u,n as M,b as a,t as v,a as p,A as k,P as B,h as L,l as S,r as P,U as I,e as h,o as l,_ as T,w as F,k as $,F as C,V as H,g as U,R as z}from"./index-CQ9TVK9F.js";import{V as A}from"./VSwitch-BP9jhnpB.js";import{c as O}from"./VChip-cf8KEkhw.js";import{d as q}from"./VSelect-BQ0Dfuub.js";import{V as N}from"./VPagination-HmQGxjeB.js";class j{static async fetchReservations(){const i=await o.get("/recording/reservations");return i.type==="error"?(o.showGenericError(i,"録画予約一覧を取得できませんでした。"),null):i.data}static async fetchReservation(i){const r=await o.get(`/recording/reservations/${i}`);return r.type==="error"?(o.showGenericError(r,"録画予約情報を取得できませんでした。"),null):r.data}static async addReservation(i,r){const _={program_id:i,record_settings:r},s=await o.post("/recording/reservations",_);if(s.type==="error"){switch(s.data.detail){case"This API is only available when the backend is EDCB":o.showGenericError(s,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified program was not found":o.showGenericError(s,"指定された番組が見つかりませんでした。");break;case"Specified channel was not found":o.showGenericError(s,"指定されたチャンネルが見つかりませんでした。");break;case"The same program_id is already reserved":o.showGenericError(s,"この番組は既に録画予約されています。");break;case"Failed to add a recording reservation":o.showGenericError(s,"録画予約の追加に失敗しました。");break;default:o.showGenericError(s,"録画予約の追加に失敗しました。");break}return!1}return!0}static async updateReservation(i,r){const _={record_settings:r},s=await o.put(`/recording/reservations/${i}`,_);if(s.type==="error"){switch(s.data.detail){case"This API is only available when the backend is EDCB":o.showGenericError(s,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":o.showGenericError(s,"指定された録画予約が見つかりませんでした。");break;case"Failed to update the specified recording reservation":o.showGenericError(s,"録画予約の更新に失敗しました。");break;default:o.showGenericError(s,"録画予約の更新に失敗しました。");break}return null}return s.data}static async deleteReservation(i){const r=await o.delete(`/recording/reservations/${i}`);if(r.type==="error"){switch(r.data.detail){case"This API is only available when the backend is EDCB":o.showGenericError(r,"この機能は EDCB バックエンド利用時のみ使用できます。");break;case"Specified reservation_id was not found":o.showGenericError(r,"指定された録画予約が見つかりませんでした。");break;case"Failed to delete the specified recording reservation":o.showGenericError(r,"録画予約の削除に失敗しました。");break;default:o.showGenericError(r,`録画予約 (ID: ${i}) の削除に失敗しました。`);break}return!1}return!0}}const J={class:"reservation__container"},K={class:"reservation__controls"},Q={class:"reservation__priority"},W={class:"reservation__priority-badge"},X={class:"reservation__toggle"},Y={class:"reservation__toggle-label"},Z={class:"reservation__content"},x={class:"reservation__content-header"},ee=["innerHTML"],te={class:"reservation__content-status"},re={class:"reservation__content-meta"},se={class:"reservation__content-meta-broadcaster"},ae=["src"],oe={class:"reservation__content-meta-broadcaster-name"},ne={class:"reservation__content-meta-time"},ie={class:"reservation__content-meta-size-comment"},le={class:"reservation__content-meta-size"},de={key:0,class:"reservation__content-meta-comment"},ce=["innerHTML"],ue=G({__name:"Reservation",props:{reservation:{}},emits:["deleted"],setup(E,{emit:i}){const r=E,_=D(),s=f(r.reservation.record_settings.is_enabled),m=f(!1);b(()=>r.reservation.record_settings.is_enabled,e=>{s.value=e});const d=e=>{const c=e.target;c.src=`${I.api_base_url}/channels/gr001/logo`},V=e=>{if(e.is_recording_in_progress)return"録画中";switch(e.recording_availability){case"Full":return"録画可能";case"Partial":return"一部録画";case"Unavailable":return"録画不可";default:return"不明"}},R=e=>{if(e.is_recording_in_progress)return"fluent:record-20-filled";switch(e.recording_availability){case"Full":return"fluent:checkmark-circle-20-regular";case"Partial":return"fluent:warning-20-regular";case"Unavailable":return"fluent:dismiss-circle-20-regular";default:return"fluent:question-circle-20-regular"}},t=e=>{if(e.is_recording_in_progress)return"primary";switch(e.recording_availability){case"Full":return"success";case"Partial":return"warning";case"Unavailable":return"error";default:return"grey"}},n=()=>{const c=B.getProgramDuration(r.reservation.program).match(/(\d+)分/),y=c?parseInt(c[1]):30,w=Math.round(y*60/10)*10;return w>=1e3?`${(w/1e3).toFixed(1)}GB`:`${w}MB`},g=async()=>{if(!m.value){m.value=!0;try{const e={...r.reservation.record_settings,is_enabled:s.value};await j.updateReservation(r.reservation.id,e)?_.show("success",`予約を${s.value?"有効":"無効"}にしました。`):s.value=r.reservation.record_settings.is_enabled}catch(e){console.error("Failed to update reservation:",e),s.value=r.reservation.record_settings.is_enabled}finally{m.value=!1}}};return(e,c)=>{const y=P("Icon");return l(),u("div",{class:M(["reservation",{"reservation--disabled":!e.reservation.record_settings.is_enabled}])},[a("div",J,[a("div",K,[a("div",Q,[a("div",W,v(e.reservation.record_settings.priority),1),c[1]||(c[1]=a("div",{class:"reservation__priority-label"},"優先度",-1))]),a("div",X,[p(A,{modelValue:s.value,"onUpdate:modelValue":[c[0]||(c[0]=w=>s.value=w),g],color:"primary",density:"compact","hide-details":""},null,8,["modelValue"]),a("div",Y,v(s.value?"有効":"無効"),1)])]),a("div",Z,[a("div",x,[a("div",{class:"reservation__content-title",innerHTML:k(B).decorateProgramInfo(e.reservation.program,"title")},null,8,ee),a("div",te,[p(O,{color:t(e.reservation),size:"small",variant:"tonal"},{default:L(()=>[p(y,{icon:R(e.reservation),width:"12px",height:"12px",class:"mr-1"},null,8,["icon"]),S(" "+v(V(e.reservation)),1)]),_:1},8,["color"])])]),a("div",re,[a("div",se,[a("img",{class:"reservation__content-meta-broadcaster-icon",loading:"lazy",decoding:"async",src:`${k(I).api_base_url}/channels/${e.reservation.channel.id}/logo`,onError:d},null,40,ae),a("span",oe,"Ch: "+v(e.reservation.channel.channel_number)+" "+v(e.reservation.channel.name),1)]),a("div",ne,v(k(B).getProgramTime(e.reservation.program)),1),a("div",ie,[a("div",le,[p(y,{icon:"fluent:hard-drive-20-filled",width:"14px",height:"14px",class:"mr-1"}),S(" 予想: "+v(n()),1)]),e.reservation.comment?(l(),u("div",de,[p(y,{icon:"fluent:note-20-filled",width:"14px",height:"14px",class:"mr-1"}),S(" "+v(e.reservation.comment),1)])):h("",!0)])]),a("div",{class:"reservation__content-description",innerHTML:k(B).decorateProgramInfo(e.reservation.program,"description")},null,8,ce)])])],2)}}}),ve=T(ue,[["__scopeId","data-v-53a30b2f"]]),_e={key:0,class:"reservation-list__header"},pe={class:"reservation-list__title"},me={class:"reservation-list__title-text"},he={key:1,class:"reservation-list__title-count"},ge={class:"reservation-list__actions"},fe={class:"reservation-list__empty-content"},ye=["innerHTML"],we=["innerHTML"],be={class:"reservation-list__grid-content"},ke={key:1,class:"reservation-list__pagination"},Ee=G({__name:"ReservationList",props:{title:{},reservations:{},total:{},page:{default:1},sortOrder:{default:"desc"},hideHeader:{type:Boolean,default:!1},hideSort:{type:Boolean,default:!1},hidePagination:{type:Boolean,default:!1},showMoreButton:{type:Boolean,default:!1},showBackButton:{type:Boolean,default:!1},showEmptyMessage:{type:Boolean,default:!0},emptyIcon:{default:"fluent:warning-20-regular"},emptyMessage:{default:"録画予約が見つかりませんでした。"},emptySubMessage:{default:"番組表から録画予約を追加できます。"},isLoading:{type:Boolean,default:!1}},emits:["update:page","update:sortOrder","more","delete"],setup(E,{emit:i}){const r=E,_=f(r.page),s=f(r.sortOrder),m=f([...r.reservations]),d=f(r.total);b(()=>r.page,t=>{_.value=t}),b(()=>r.sortOrder,t=>{s.value=t}),b(()=>r.reservations,t=>{m.value=[...t]}),b(()=>r.total,t=>{d.value=t});const V=i,R=t=>{m.value=m.value.filter(n=>n.id!==t),d.value=Math.max(0,d.value-1),V("delete",t)};return(t,n)=>{const g=P("Icon");return l(),u("div",{class:M(["reservation-list",{"reservation-list--show-sort":!t.hideSort}])},[t.hideHeader?h("",!0):(l(),u("div",_e,[a("h2",pe,[t.showBackButton?F((l(),u("div",{key:0,class:"reservation-list__title-back",onClick:n[0]||(n[0]=e=>t.$router.back())},[p(g,{icon:"fluent:chevron-left-12-filled",width:"27px"})])),[[z]]):h("",!0),a("span",me,v(t.title),1),t.showMoreButton?h("",!0):(l(),u("div",he,[t.isLoading?(l(),$(g,{key:0,icon:"line-md:loading-twotone-loop",class:"mr-1 spin",width:"20px",height:"20px"})):(l(),u(C,{key:1},[S(v(d.value)+"件",1)],64))]))]),a("div",ge,[t.hideSort?h("",!0):(l(),$(q,{key:0,modelValue:s.value,"onUpdate:modelValue":[n[1]||(n[1]=e=>s.value=e),n[2]||(n[2]=e=>t.$emit("update:sortOrder",e))],items:[{title:"放送が近い順",value:"asc"},{title:"放送が遠い順",value:"desc"}],"item-title":"title","item-value":"value",class:"reservation-list__sort",color:"primary","bg-color":"background-lighten-1",variant:"solo",density:"comfortable","hide-details":""},null,8,["modelValue"])),t.showMoreButton?(l(),$(H,{key:1,variant:"text",class:"reservation-list__more",onClick:n[3]||(n[3]=e=>t.$emit("more"))},{default:L(()=>[n[6]||(n[6]=a("span",{class:"text-primary"},"もっと見る",-1)),p(g,{icon:"fluent:chevron-right-12-regular",width:"18px",class:"ml-1 text-text-darken-1",style:{margin:"0px -4px"}})]),_:1,__:[6]})):h("",!0)])])),a("div",{class:M(["reservation-list__grid",{"reservation-list__grid--loading":t.isLoading,"reservation-list__grid--empty":d.value===0&&t.showEmptyMessage}])},[a("div",{class:M(["reservation-list__empty",{"reservation-list__empty--show":d.value===0&&t.showEmptyMessage&&!t.isLoading}])},[a("div",fe,[p(g,{class:"reservation-list__empty-icon",icon:t.emptyIcon,width:"54px",height:"54px"},null,8,["icon"]),a("h2",{innerHTML:t.emptyMessage},null,8,ye),t.emptySubMessage?(l(),u("div",{key:0,class:"reservation-list__empty-submessage",innerHTML:t.emptySubMessage},null,8,we)):h("",!0)])],2),a("div",be,[(l(!0),u(C,null,U(m.value,e=>(l(),$(ve,{key:e.id,reservation:e,onDeleted:R},null,8,["reservation"]))),128))])],2),!t.hidePagination&&d.value>0?(l(),u("div",ke,[p(N,{modelValue:_.value,"onUpdate:modelValue":[n[4]||(n[4]=e=>_.value=e),n[5]||(n[5]=e=>t.$emit("update:page",e))],"active-color":"primary",density:"comfortable",length:Math.ceil(d.value/30),"total-visible":k(I).isSmartphoneVertical()?5:7},null,8,["modelValue","length","total-visible"])])):h("",!0)],2)}}}),Re=T(Ee,[["__scopeId","data-v-14969307"]]);export{Re as R,j as a};
