import{H as fa,N as ha}from"./Navigation-DznrOksx.js";import{u as ga,R as pa,a as Ue,I as wt}from"./ReservationDetailDrawer-BgdtJMRu.js";import{T as de,a as ya}from"./TimeTableSettings-BuvHsmI1.js";import{S as _a}from"./SPHeaderBar-B-d-gzjA.js";import{d as Ie,G as d,w as ut,j as Lt,k as fe,r as Qe,f as ue,h as q,b as O,B as pe,U as Re,t as Te,o as Y,_ as Be,ae as ba,u as Ee,q as _,af as $e,N as F,s as ye,ag as ka,x as Je,z as dt,c as Z,e as ce,n as Ke,a as o,p as Pt,V as K,P as Fe,a2 as Ce,F as De,g as Oe,ac as Sa,ah as Ct,D as we,E as Se,O as He,X as Xe,ai as vt,aj as Ze,ak as Da,al as Le,T as xe,am as qe,an as Ta,l as ct,Y as Ye,ao as Nt,ap as Wt,Q as me,aq as Ut,ar as wa,as as Pa,at as Ft,au as Ca,av as xa,aw as Ha,ax as Ma,ay as Va,az as Ia,aA as Ba,I as Aa,aB as Oa,aC as Ra,aD as $a,aE as Ya,aF as Ea,J as La,aG as Na,aH as Wa,aI as Ua,M as rt}from"./index-BLkZZ7E9.js";import{u as Fa,P as Ga}from"./ChannelsStore-Nk6wPmBo.js";import{c as Ge,d as xt}from"./VSelect-DK1o78Mb.js";import{V as ja,c as za}from"./ssrBoot-BxzOBo2h.js";import{M as Gt}from"./VAvatar-BeuHp1VN.js";import{b as Xa}from"./VTextField-rdunuNKI.js";import"./VSwitch-Dq08AtwE.js";import"./VChip-BEStWQsU.js";import"./VSlider-O7e0yjyP.js";import"./VDialog-8TKIPvFd.js";import"./VCard-BL5-8DIo.js";const qa={class:"timetable-channel-header__logo-wrapper"},Ka=["src","alt"],Qa={class:"timetable-channel-header__info"},Ja={class:"timetable-channel-header__number"},Za={class:"timetable-channel-header__name"},el=Ie({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{}},setup(e){const l=e,v=d(()=>Math.round(Math.min(46,Math.max(32,l.width*.3)))),s=d(()=>Math.round(v.value*(2/3))),t=d(()=>Math.round(Math.min(15,Math.max(13,l.width*.09)))),g=d(()=>Math.round(Math.min(14,Math.max(12,l.width*.08)))),r=d(()=>`${l.channel.name} を視聴`);return(h,a)=>{const i=Qe("router-link"),c=Lt("ftooltip");return ut((Y(),fe(i,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:ue({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${g.value}px`})},{default:q(()=>[O("div",qa,[O("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${pe(Re).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,Ka)]),O("div",Qa,[O("span",Ja,Te(e.channel.channel_number),1),O("span",Za,Te(e.channel.name),1)])]),_:1},8,["to","style"])),[[c,r.value,void 0,{top:!0}]])}}}),tl=Be(el,[["__scopeId","data-v-8ea13d98"]]),jt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],al=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),Ne=ba("timetable",()=>{const e=Ee(),l=Fa(),v=_(null),s=_(T()),t=_({x:0,y:0}),g=$e([]),r=_(null),h=_(null),a=_(!1),i=_(!1),c=_(!0),u=_(!1),x=_(null);function j(){const m=F(),S=T();if(s.value.isSame(S,"day")===!1)return!1;let $=m.hour();return $<4&&($+=24),$>=17}function b(){const m=F(),S=T();if(s.value.isSame(S,"day")===!1)return null;const $=m.startOf("hour").subtract(1,"hour"),ae=w();return $.isBefore(ae)?ae:$}function w(){return u.value?s.value.add(12,"hour"):s.value}function T(){const m=F();let S=m.hour(4).minute(0).second(0).millisecond(0);return m.hour()<4&&(S=S.subtract(1,"day")),S}function H(m,S=!1){return S?m.add(36,"hour"):m.add(1,"day")}const y=d(()=>u.value?s.value.add(12,"hour"):s.value),E=d(()=>u.value?y.value.add(36,"hour"):s.value.add(24,"hour")),N=d(()=>{if(r.value===null)return[];const m=[];let S=r.value.earliest.hour(4).minute(0).second(0).millisecond(0);r.value.earliest.hour()<4&&(S=S.subtract(1,"day"));const $=r.value.latest;for(;S.isSameOrBefore($);)m.push(S),S=S.add(1,"day");return m}),W=d(()=>{const m=new Set;if(l.is_channels_list_initial_updated===!1)return m;for(const S of l.channels_list_with_pinned.keys()){if(S==="ピン留め"){const $=l.channels_list_with_pinned.get("ピン留め");if($===void 0||$.length===0)continue}m.add(S)}return m});function le(){return v.value===null?Q():W.value.has(v.value)?null:Q()}function Q(){if(W.value.has("ピン留め"))return"ピン留め";if(W.value.has("地デジ"))return"地デジ";for(const m of jt)if(W.value.has(m))return m;return"地デジ"}async function z(m,S,$,ae){u.value=j(),x.value=b();const se=m??w(),D=S??H(se,u.value),p=$??v.value??"地デジ",I=p==="ピン留め"?ae??e.settings.pinned_channel_ids:void 0,ie=al.get(p),M=await Ga.fetchTimeTable(se,D,ie,I);return M===null?!1:(g.value=M.channels,r.value={earliest:F(M.date_range.earliest),latest:F(M.date_range.latest)},!0)}async function k(){a.value=!0,i.value=!1,h.value=null;try{if(await l.update(),s.value=T(),v.value=Q(),await z()===!1){a.value=!1;return}i.value=!0}finally{a.value=!1}}async function B(m){a.value=!0,h.value=null;try{s.value=m,await z()}finally{a.value=!1}}async function R(m){a.value=!0,h.value=null;try{v.value=m,await z()}finally{a.value=!1}}async function G(){if(r.value===null)return;const m=s.value.subtract(1,"day");m.isBefore(r.value.earliest,"day")||await B(m)}async function ne(){if(r.value===null)return;const m=s.value.add(1,"day");m.isAfter(r.value.latest,"day")||await B(m)}async function ee(){c.value=!0;const m=T();s.value.isSame(m,"day")===!1&&await B(m)}function J(m){h.value=m}function L(m,S){t.value={x:m,y:S}}function _e(){c.value=!1}function he(){c.value=!0}function C(){g.value=[],r.value=null,h.value=null,a.value=!1,i.value=!1,c.value=!0,u.value=!1,x.value=null,t.value={x:0,y:0},v.value=null}return ye(()=>e.settings.pinned_channel_ids,async(m,S)=>{v.value==="ピン留め"&&i.value!==!1&&ka(m,S)===!1&&await z()},{deep:!0}),ye(()=>l.channels_list_with_pinned,async()=>{if(i.value===!1)return;const m=le();m!==null&&await R(m)},{deep:!0}),{selected_channel_type:v,selected_date:s,scroll_position:t,channels_data:g,date_range:r,selected_program_id:h,is_loading:a,is_initial_load_completed:i,is_auto_scroll_enabled:c,is_36hour_display:u,scroll_top_limit_time:x,selectable_dates:N,available_channel_types:W,display_start_time:y,display_end_time:E,getTodayStartTime:T,getDayEndTime:H,getDisplayStartTime:w,fetchTimeTableData:z,initialLoad:k,changeDate:B,changeChannelType:R,goToPreviousDay:G,goToNextDay:ne,goToCurrentTime:ee,selectProgram:J,updateScrollPosition:L,disableAutoScroll:_e,enableAutoScroll:he,reset:C}}),ll=Ie({__name:"TimeTableCurrentTimeLine",props:{selectedDate:{},hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const l=e,v=Ne(),s=_(F());let t=null,g=null;const r=d(()=>{const a=s.value,i=v.getDisplayStartTime(),c=v.getDayEndTime(i,v.is_36hour_display);return a.isSameOrAfter(i)&&a.isBefore(c)}),h=d(()=>{if(!r.value)return 0;const a=v.getDisplayStartTime();return de.calculateCurrentTimeY(s.value,a,l.hourHeight,l.channelHeaderHeight)-l.channelHeaderHeight});return Je(()=>{const a=F(),i=a.add(1,"minute").startOf("minute"),c=Math.max(0,i.valueOf()-a.valueOf());g=setTimeout(()=>{s.value=F(),t=setInterval(()=>{s.value=F()},60*1e3)},c)}),dt(()=>{g!==null&&clearTimeout(g),t!==null&&clearInterval(t)}),(a,i)=>r.value?(Y(),Z("div",{key:0,class:"timetable-current-time-line",style:ue({top:`${h.value}px`,width:`${e.totalWidth}px`})},[...i[0]||(i[0]=[O("div",{class:"timetable-current-time-line__indicator"},null,-1),O("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):ce("",!0)}}),nl=Be(ll,[["__scopeId","data-v-bfa815a2"]]),il={class:"timetable-program-cell__content"},ol={class:"timetable-program-cell__header"},sl={class:"timetable-program-cell__start-minute"},rl={key:0,class:"timetable-program-cell__reservation-icon"},ul={key:0,class:"timetable-program-cell__recording-icon"},cl=["innerHTML"],dl=["innerHTML"],vl={key:0,class:"timetable-program-cell__actions"},ml="fluent:timer-16-filled",fl="mdi:timer-pause-outline",hl=Ie({__name:"TimeTableProgramCell",props:{program:{},channel:{},selectedDate:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:l}){const v=new Map;function s(C,m){const S=C.title,$=C.description;if(S===null||$===null)return Fe.decorateProgramInfo(C,m);const ae=v.get(C.id);if(ae===void 0||ae.raw_title!==S||ae.raw_description!==$){const D=Fe.decorateProgramInfo(C,"title"),p=Fe.decorateProgramInfo(C,"description");v.set(C.id,{raw_title:S,raw_description:$,title:D,description:p})}const se=v.get(C.id);return se===void 0?Fe.decorateProgramInfo(C,m):m==="title"?se.title:se.description}const t=e,g=l,r=Ee(),h=Ne(),a=_(!1),i=_(null),c=_(0),u=d(()=>t.isSelected||r.settings.timetable_hover_expand&&a.value),x=d(()=>t.program.reservation!==null),j=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.status)==="Recording"}),b=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.status)==="Disabled"}),w=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.recording_availability)==="Partial"}),T=d(()=>{var C;return((C=t.program.reservation)==null?void 0:C.recording_availability)==="Unavailable"}),H=d(()=>T.value?"rgb(var(--v-theme-error))":w.value?"rgb(var(--v-theme-warning))":b.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-success))"),y=d(()=>b.value?fl:ml),E=d(()=>x.value?b.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),N=d(()=>x.value?b.value?"予約を有効化":"予約を無効化":"録画予約"),W=d(()=>F(t.program.start_time).minute().toString().padStart(2,"0")),le=d(()=>{var S,$;const C=($=(S=t.program.genres)==null?void 0:S[0])==null?void 0:$.major;return de.getGenreColors(C,r.settings.timetable_genre_colors).highlight}),Q=d(()=>t.isPast?"#b0b0b0":le.value),z=d(()=>{var S,$;if(t.isPast)return"#e6e6e6";if(T.value)return"#f8d7da";if(w.value)return"#fff3cd";const C=($=(S=t.program.genres)==null?void 0:S[0])==null?void 0:$.major;return de.getGenreColors(C,r.settings.timetable_genre_colors).background}),k=d(()=>{const C=F(t.program.start_time),m=h.getDisplayStartTime();return de.calculateProgramY(C,m,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),B=d(()=>(t.is36HourDisplay?36:24)*t.hourHeight),R=d(()=>{const C=de.calculateProgramHeight(t.program.duration,t.hourHeight);if(k.value+C>B.value){const S=B.value-k.value;return Math.max(S,20)}return Math.max(C,20)}),G=d(()=>{const C=t.fullChannelWidth??t.channelWidth,m=t.isSplit===!0&&t.channelWidth<C,S=u.value&&c.value>0?c.value:R.value,$=t.isSubchannel&&m?t.channelWidth:0,ae=u.value&&m?0:$,se=u.value&&m?C:t.channelWidth,D={top:`${k.value}px`,left:`${ae}px`,width:`${se}px`,minHeight:`${R.value}px`,background:z.value,"--timetable-cell-height":`${S}px`};if(u.value||(D.height=`${R.value}px`),u.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const p=c.value>0?c.value:R.value,I=Math.max(0,B.value-t.viewportHeight),ie=I+t.viewportHeight,M=k.value+p,be=k.value+R.value>=B.value-1;if(M>ie&&be){const X=M-ie,Pe=Math.max(0,k.value-I),re=Math.min(X,Pe);re>0&&(D.transform=`translateY(-${re}px)`)}}return D}),ne=d(()=>s(t.program,"title")),ee=d(()=>s(t.program,"description"));function J(){g("click")}function L(){a.value=!0}function _e(){a.value=!1}function he(){g("quick-reserve")}return ye(u,async C=>{if(C===!1){c.value=0;return}await Ce(),i.value!==null&&(c.value=Math.max(i.value.getBoundingClientRect().height,R.value))}),(C,m)=>{const S=Qe("Icon");return Y(),Z("div",{class:Ke(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":u.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":x.value,"timetable-program-cell--recording":j.value,"timetable-program-cell--partial":w.value,"timetable-program-cell--unavailable":T.value,"timetable-program-cell--disabled":b.value}]),ref_key:"cellRef",ref:i,style:ue(G.value),onClick:J,onMouseenter:L,onMouseleave:_e},[O("div",{class:"timetable-program-cell__highlight",style:ue({background:Q.value})},null,4),O("div",il,[O("div",ol,[O("span",sl,Te(W.value),1),x.value?(Y(),Z("div",rl,[o(S,{icon:y.value,width:"14px",style:ue({color:H.value})},null,8,["icon","style"]),j.value?(Y(),Z("div",ul)):ce("",!0),w.value?(Y(),fe(S,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):ce("",!0),T.value?(Y(),fe(S,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):ce("",!0)])):ce("",!0)]),O("div",{class:"timetable-program-cell__title",innerHTML:ne.value},null,8,cl),O("div",{class:"timetable-program-cell__description",innerHTML:ee.value},null,8,dl),u.value?(Y(),Z("div",vl,[o(K,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:m[0]||(m[0]=Pt($=>C.$emit("show-detail"),["stop"]))},{default:q(()=>[o(S,{icon:"fluent:info-12-regular",width:"16px"}),m[1]||(m[1]=O("span",null,"番組詳細",-1))]),_:1}),e.isPast?ce("",!0):(Y(),fe(K,{key:0,variant:"flat",size:"small",class:Ke(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":x.value&&!b.value,"timetable-program-cell__action-button--disabled-reservation":b.value}]),onClick:Pt(he,["stop"])},{default:q(()=>[o(S,{icon:E.value,width:"16px"},null,8,["icon"]),O("span",null,Te(N.value),1)]),_:1},8,["class"]))])):ce("",!0)])],38)}}}),Ht=Be(hl,[["__scopeId","data-v-6eac5de8"]]),gl={class:"timetable-time-scale"},pl={class:"timetable-time-scale__label"},yl={key:0,class:"timetable-time-scale__date"},_l={class:"timetable-time-scale__hour-number"},bl=Ie({__name:"TimeTableTimeScale",props:{selectedDate:{},hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const l=e,v=Ee(),s=Ne(),t=d(()=>{const i=l.is36HourDisplay?36:24,c=s.display_start_time,u=[];for(let x=0;x<i;x++)u.push(c.add(x,"hour"));return u});function g(i){return de.getTimeScaleColor(i.hour())}function r(i){const c=i.hour();return v.settings.use_28hour_clock&&c>=0&&c<=3?(c+24).toString().padStart(2,"0"):c.toString().padStart(2,"0")}function h(i){const c=i.hour(),u=s.display_start_time;return!([0,4,8,12,16,20].includes(c)===!1||l.is36HourDisplay&&c===4&&u.hour()===4)}function a(i){return`${i.month()+1}/${i.date()}`}return(i,c)=>(Y(),Z("div",gl,[(Y(!0),Z(De,null,Oe(t.value,u=>(Y(),Z("div",{class:"timetable-time-scale__hour",key:u.valueOf(),style:ue({height:`${l.hourHeight}px`,background:g(u)})},[O("div",pl,[h(u)?(Y(),Z("span",yl,Te(a(u)),1)):ce("",!0),O("span",_l,Te(r(u)),1),c[0]||(c[0]=O("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],4))),128))]))}}),kl=Be(bl,[["__scopeId","data-v-7645d931"]]),Sl={class:"timetable-grid__channel-headers"},Dl={class:"timetable-grid__content"},Tl=2,wl=3,Pl=.5,Mt=1,Cl=60,xl=2,Hl=120,Vt=.95,je=.5,ze=5,Ml=Ie({__name:"TimeTableGrid",props:{channels:{},selectedDate:{},isLoading:{type:Boolean},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["scroll-position-change","time-slot-change","date-display-offset-change","program-select","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:l,emit:v}){const s=de.EMPTY_CELL_BACKGROUND_COLOR,t=e,g=v,r=Ee(),h=Ne(),a=_(null),i=_(null),c=_(!1),u=_(!1),x=_(!1);let j=0;const b=_(0),w=_(!1),T=_(0),H=_(0),y=_(0),E=_(0),N=_(null);let W=0,le=0,Q=null,z=null;const k=_(0),B=_(0),R=new Set;let G=null,ne=null,ee=null;const J=_(!1),L=_(!1),_e=_(!1),he=_(null),C=_(0),m=_(0),S=_(0),$=_(0),ae=_(!1),se=_(!1),D=_(0),p=_(0),I=_(0),ie=_(0),M=_(0),be=_(0),X=_(null),Pe=d(()=>de.getDeviceType()),re=d(()=>de.getChannelWidth(r.settings.timetable_channel_width,Pe.value)),oe=d(()=>de.getHourHeight(r.settings.timetable_hour_height,Pe.value)),mt=d(()=>Pe.value==="Smartphone"?wl:Tl),ve=d(()=>de.getChannelHeaderHeight(re.value)),et=d(()=>de.getTimeScaleWidth(Pe.value,Re.isSmartphoneVertical())),ft=d(()=>t.channels.length*re.value),We=d(()=>(t.is36HourDisplay?36:24)*oe.value);function Zt(n){return n.subchannel_programs===null?!1:Object.values(n.subchannel_programs).flat().length>0}const tt=new Map,Me=new Map;function at(n){if(n==null)return{start:0,end:0};const f=tt.get(n.id);if(f!==void 0)return f;const V={start:F(n.start_time).valueOf(),end:F(n.end_time).valueOf()};return tt.set(n.id,V),V}function ht(n,f){const V=at(n);return f.some(P=>{const U=at(P);return U.start<V.end&&U.end>V.start})}function lt(n,f,V){const P=`${f.id}:${V?"sub":"main"}`,U=Me.get(P);if(U!==void 0)return U;if(n.subchannel_programs===null)return Me.set(P,!1),!1;const A=Object.values(n.subchannel_programs).flat();if(A.length===0)return Me.set(P,!1),!1;if(V){const ge=ht(f,n.programs);return Me.set(P,ge),ge}const te=ht(f,A);return Me.set(P,te),te}function gt(n,f,V){return lt(n,f,V)?re.value/2:re.value}function Ve(n){const f=oe.value*mt.value;T.value=Math.max(0,n-f),H.value=n+b.value+f}function ea(n){const V=oe.value*mt.value*Pl,P=n+b.value;return b.value<=0||H.value===0||n<T.value+V||P>H.value-V?(Ve(n),!0):!1}function pt(n){const f=at(n),V=(f.start-k.value)/(1e3*60*60)*oe.value;return(f.end-k.value)/(1e3*60*60)*oe.value>=T.value&&V<=H.value}function ta(n){return n.subchannel_programs===null?[]:Object.values(n.subchannel_programs).flat()}function yt(n){return F(n.end_time).isBefore(F())}function _t(){if(a.value===null)return;const n=y.value,f=E.value;j=f;const V=a.value.clientHeight-ve.value;b.value!==V&&(b.value=V);const P=a.value.scrollHeight-a.value.clientHeight,U=f>=P-1;w.value!==U&&(w.value=U),ea(f)&&Ae(),(Math.abs(n-W)>=Mt||Math.abs(f-le)>=Mt)&&(g("scroll-position-change",{x:n,y:f}),W=n,le=f);const te=f>P-100&&t.canGoNextDay,ge=f<100&&t.canGoPreviousDay;c.value!==te&&(c.value=te),u.value!==ge&&(u.value=ge);const ke=Math.floor(f/oe.value)+B.value,it=Math.floor((ke-4)/4)*4+4,ot=Math.max(4,Math.min(24,it));if(Q!==ot&&(g("time-slot-change",ot),Q=ot),t.is36HourDisplay){const ma=r.settings.use_28hour_clock?12*oe.value:8*oe.value,st=f>=ma?1:0;z!==st&&(g("date-display-offset-change",st),z=st)}else z!==0&&(g("date-display-offset-change",0),z=0);bt()}function aa(){N.value===null&&(N.value=requestAnimationFrame(()=>{N.value=null,_t()}))}function Ae(){ee===null&&(ee=requestAnimationFrame(()=>{ee=null,kt()}))}function bt(){ne===null&&(ne=requestAnimationFrame(()=>{ne=null,la()}))}function kt(){a.value!==null&&(G!==null&&(G.disconnect(),R.clear()),G=new IntersectionObserver(n=>{for(const f of n){const V=f.target,P=f.rootBounds;if(P===null)continue;const U=f.intersectionRect.top<=P.top,A=f.intersectionRect.height<f.boundingClientRect.height,te=P.height<f.boundingClientRect.height;if(f.isIntersecting&&U&&(A||te))R.add(V),V.classList.add("timetable-program-cell--fixed");else{R.delete(V),V.classList.remove("timetable-program-cell--fixed");const ke=V.querySelector(".timetable-program-cell__content");ke!==null&&(ke.style.paddingTop="")}}bt()},{root:a.value,rootMargin:`-${ve.value}px 0px 0px 0px`,threshold:[0,1]}),a.value.querySelectorAll(".timetable-program-cell").forEach(n=>{G==null||G.observe(n)}))}function la(){if(a.value===null||R.size===0)return;const n=a.value.getBoundingClientRect().top+ve.value;R.forEach(f=>{const V=f.querySelector(".timetable-program-cell__content");if(V===null)return;const P=f.getBoundingClientRect().top,U=n-P;if(U<=0){V.style.paddingTop="";return}const A=f.style.getPropertyValue("--timetable-cell-height"),te=A?Number.parseFloat(A):f.getBoundingClientRect().height,ge=Math.max(0,te-Cl),ke=f.classList.contains("timetable-program-cell--reserved")?3:0,it=Math.min(U,ge);V.style.paddingTop=`${xl+Math.max(it-ke,0)}px`})}function na(){a.value!==null&&(y.value=a.value.scrollLeft,E.value=a.value.scrollTop,aa())}function St(n){a.value!==null&&(X.value!==null&&(cancelAnimationFrame(X.value),X.value=null),n.deltaX!==0&&(n.preventDefault(),a.value.scrollLeft+=n.deltaX),n.shiftKey&&n.deltaY!==0?(n.preventDefault(),a.value.scrollLeft+=n.deltaY):n.deltaY!==0&&n.deltaX===0&&(n.preventDefault(),a.value.scrollTop+=n.deltaY))}function ia(n){if(n.pointerType!=="mouse"||a.value===null)return;const f=n.target;f.closest(".v-btn")||f.closest("a")||(L.value=!0,J.value=!1,ae.value=!1,C.value=n.clientX,m.value=n.clientY,S.value=a.value.scrollLeft,$.value=a.value.scrollTop,X.value!==null&&(cancelAnimationFrame(X.value),X.value=null),p.value=0,I.value=0,ie.value=performance.now(),M.value=n.clientX,be.value=n.clientY)}function oa(n){if(n.pointerType!=="mouse"||L.value===!1||a.value===null)return;const f=C.value-n.clientX,V=m.value-n.clientY;if((Math.abs(f)>ze||Math.abs(V)>ze)&&J.value===!1&&a.value!==null&&(J.value=!0,ae.value=!0,a.value.setPointerCapture(n.pointerId),_e.value=!0,he.value=n.pointerId),J.value===!1)return;n.preventDefault(),(Math.abs(f)>ze||Math.abs(V)>ze)&&(ae.value=!0),a.value.scrollLeft=S.value+f,a.value.scrollTop=$.value+V;const P=performance.now(),U=P-ie.value;if(U>0){const A=n.clientX-M.value,te=n.clientY-be.value;p.value=-A/U*16,I.value=-te/U*16}ie.value=P,M.value=n.clientX,be.value=n.clientY}function Dt(n){if(n.pointerType==="mouse"&&L.value!==!1){if(L.value=!1,J.value=!1,a.value!==null&&_e.value&&he.value!==null)try{a.value.releasePointerCapture(he.value)}catch{}_e.value=!1,he.value=null,ae.value?(ra(),se.value=!0,D.value=performance.now()):(se.value=!1,D.value=0)}}function sa(n){if(se.value===!1)return;performance.now()-D.value<=Hl&&(n.preventDefault(),n.stopPropagation()),se.value=!1}function ra(){if(a.value===null||Math.abs(p.value)<je&&Math.abs(I.value)<je)return;const n=()=>{if(a.value!==null){if(p.value*=Vt,I.value*=Vt,a.value.scrollLeft+=p.value,a.value.scrollTop+=I.value,Math.abs(p.value)<je&&Math.abs(I.value)<je){X.value=null;return}X.value=requestAnimationFrame(n)}};X.value=requestAnimationFrame(n)}function Tt(n){i.value===n.id?(i.value=null,g("program-select",null)):(i.value=n.id,g("program-select",n.id))}function ua(n){if(a.value===null)return;const V=(n>=4?n-4:n+20)*oe.value;a.value.scrollTo({top:V,behavior:"smooth"})}function ca(){const n=h.scroll_top_limit_time;if(n===null)return 0;const f=h.getDisplayStartTime(),P=(n.valueOf()-f.valueOf())/(1e3*60*60);return Math.max(0,P*oe.value)}function nt(n=!0,f=!1){if(a.value===null)return;const V=F(),P=h.getDisplayStartTime(),U=ca(),ge=(V.subtract(30,"minute").valueOf()-P.valueOf())/(1e3*60*60),ke=Math.max(U,ge*oe.value);if(f){a.value.scrollTo({top:ke,behavior:n?"smooth":"instant"});return}if(U===0){a.value.scrollTo({top:0,behavior:"instant"});return}a.value.scrollTo({top:U,behavior:"instant"}),n&&setTimeout(()=>{a.value!==null&&a.value.scrollTo({top:ke,behavior:"smooth"})},50)}function da(){a.value!==null&&a.value.scrollTo({top:0,behavior:"instant"})}function va(){if(a.value===null)return;const n=a.value.scrollHeight-a.value.clientHeight;a.value.scrollTo({top:n,behavior:"instant"})}return l({scrollToHour:ua,scrollToCurrentTime:nt,scrollToStart:da,scrollToEnd:va}),Je(async()=>{a.value!==null&&a.value.addEventListener("wheel",St,{passive:!1}),await Ce(),a.value!==null&&(y.value=a.value.scrollLeft,E.value=a.value.scrollTop,_t(),kt()),setTimeout(()=>{nt(),Ve(j)},100)}),Sa(()=>{a.value!==null&&a.value.removeEventListener("wheel",St),N.value!==null&&cancelAnimationFrame(N.value),ne!==null&&cancelAnimationFrame(ne),ee!==null&&cancelAnimationFrame(ee),G!==null&&(G.disconnect(),G=null,R.clear()),X.value!==null&&cancelAnimationFrame(X.value)}),dt(()=>{X.value!==null&&cancelAnimationFrame(X.value)}),ye(()=>t.channels,async(n,f)=>{tt.clear(),Me.clear(),Ve(j),Ae(),f.length===0&&n.length>0&&(await Ce(),setTimeout(()=>{nt(),x.value=!0,Ae()},100))},{deep:!1}),ye([oe,b],()=>{Ve(j),Ae()}),ye(ve,()=>{Ae()}),ye(()=>h.display_start_time,n=>{k.value=n.valueOf(),B.value=n.hour()},{immediate:!0}),(n,f)=>{const V=Qe("Icon");return Y(),Z("div",{class:"timetable-grid",style:ue({"--timetable-channel-header-height":`${ve.value}px`})},[O("div",{class:Ke(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":J.value}]),ref_key:"scrollAreaRef",ref:a,onScroll:na,onPointerdown:ia,onPointermove:oa,onPointerup:Dt,onPointercancel:Dt,onClickCapture:sa},[O("div",{class:"timetable-grid__layout",style:ue({width:`${et.value+ft.value}px`,height:`${ve.value+We.value}px`})},[O("div",{class:"timetable-grid__header-row",style:ue({height:`${ve.value}px`})},[O("div",{class:"timetable-grid__corner",style:ue({width:`${et.value}px`})},null,4),O("div",Sl,[(Y(!0),Z(De,null,Oe(e.channels,P=>(Y(),fe(tl,{key:P.channel.id,channel:P.channel,width:re.value,height:ve.value},null,8,["channel","width","height"]))),128))])],4),O("div",{class:"timetable-grid__body-row",style:ue({height:`${We.value}px`})},[O("div",{class:"timetable-grid__time-scale",style:ue({width:`${et.value}px`})},[o(kl,{selectedDate:t.selectedDate,hourHeight:oe.value,is36HourDisplay:t.is36HourDisplay},null,8,["selectedDate","hourHeight","is36HourDisplay"])],4),O("div",Dl,[(Y(!0),Z(De,null,Oe(e.channels,(P,U)=>(Y(),Z("div",{class:"timetable-grid__channel-column",key:P.channel.id,style:ue({left:`${U*re.value}px`,width:`${re.value}px`,height:`${We.value}px`})},[O("div",{class:"timetable-grid__channel-background",style:ue({height:`${We.value}px`,background:pe(s)})},null,4),(Y(!0),Z(De,null,Oe(P.programs,A=>(Y(),Z(De,{key:A.id},[pt(A)?(Y(),fe(Ht,{key:0,program:A,channel:P.channel,selectedDate:t.selectedDate,hourHeight:oe.value,channelWidth:gt(P,A,!1),fullChannelWidth:re.value,isSplit:lt(P,A,!1),viewportHeight:b.value,channelHeaderHeight:ve.value,isScrollAtBottom:w.value,isSelected:i.value===A.id,isPast:yt(A),is36HourDisplay:t.is36HourDisplay,onClick:te=>Tt(A),onShowDetail:te=>n.$emit("show-program-detail",A.id,P,A),onQuickReserve:te=>n.$emit("quick-reserve",A.id,P,A)},null,8,["program","channel","selectedDate","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","onClick","onShowDetail","onQuickReserve"])):ce("",!0)],64))),128)),Zt(P)?(Y(!0),Z(De,{key:0},Oe(ta(P),A=>(Y(),Z(De,{key:A.id},[pt(A)?(Y(),fe(Ht,{key:0,program:A,channel:P.channel,selectedDate:t.selectedDate,hourHeight:oe.value,channelWidth:gt(P,A,!0),fullChannelWidth:re.value,isSplit:lt(P,A,!0),viewportHeight:b.value,channelHeaderHeight:ve.value,isScrollAtBottom:w.value,isSubchannel:!0,isSelected:i.value===A.id,isPast:yt(A),is36HourDisplay:t.is36HourDisplay,onClick:te=>Tt(A),onShowDetail:te=>n.$emit("show-program-detail",A.id,P,A),onQuickReserve:te=>n.$emit("quick-reserve",A.id,P,A)},null,8,["program","channel","selectedDate","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","onClick","onShowDetail","onQuickReserve"])):ce("",!0)],64))),128)):ce("",!0)],4))),128)),o(nl,{selectedDate:t.selectedDate,hourHeight:oe.value,totalWidth:ft.value,channelHeaderHeight:ve.value},null,8,["selectedDate","hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),o(Ct,{name:"fade"},{default:q(()=>[c.value?(Y(),fe(K,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:f[0]||(f[0]=P=>n.$emit("go-to-next-day"))},{default:q(()=>[o(V,{icon:"fluent:chevron-down-20-regular",width:"20px"}),f[2]||(f[2]=O("span",null,"次の日を見る",-1))]),_:1})):ce("",!0)]),_:1}),o(Ct,{name:"fade"},{default:q(()=>[u.value?(Y(),fe(K,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:f[1]||(f[1]=P=>n.$emit("go-to-previous-day"))},{default:q(()=>[o(V,{icon:"fluent:chevron-up-20-regular",width:"20px"}),f[3]||(f[3]=O("span",null,"前の日を見る",-1))]),_:1})):ce("",!0)]),_:1})],4)}}}),Vl=Be(Ml,[["__scopeId","data-v-9a7bc54b"]]),zt=Se({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Xe,default:"$next"},prevIcon:{type:Xe,default:"$prev"},modeIcon:{type:Xe,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),It=we()({name:"VDatePickerControls",props:zt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,l){let{emit:v}=l;const s=d(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=d(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),g=d(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),r=d(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function h(){v("click:prev")}function a(){v("click:next")}function i(){v("click:year")}function c(){v("click:month")}return He(()=>o("div",{class:["v-date-picker-controls"]},[o(K,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:c},null),o(K,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:i},null),o(ja,null,null),o("div",{class:"v-date-picker-controls__month"},[o(K,{"data-testid":"prev-month",disabled:g.value,icon:e.prevIcon,variant:"text",onClick:h},null),o(K,{"data-testid":"next-month",disabled:r.value,icon:e.nextIcon,variant:"text",onClick:a},null)])])),{}}}),Il=Se({appendIcon:Xe,color:String,header:String,transition:String,onClick:Da()},"VDatePickerHeader"),Bt=we()({name:"VDatePickerHeader",props:Il(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,l){let{emit:v,slots:s}=l;const{backgroundColorClasses:t,backgroundColorStyles:g}=vt(e,"color");function r(){v("click")}function h(){v("click:append")}return He(()=>{const a=!!(s.default||e.header),i=!!(s.append||e.appendIcon);return o("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:g.value,onClick:r},[s.prepend&&o("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),a&&o(Gt,{key:"content",name:e.transition},{default:()=>{var c;return[o("div",{key:e.header,class:"v-date-picker-header__content"},[((c=s.default)==null?void 0:c.call(s))??e.header])]}}),i&&o("div",{class:"v-date-picker-header__append"},[s.append?o(Ze,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var c;return[(c=s.append)==null?void 0:c.call(s)]}}):o(K,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:h},null)])])}),{}}}),Bl=Se({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Al(e){const l=Le(),v=xe(e,"modelValue",[],b=>qe(b).map(w=>l.date(w))),s=d(()=>e.displayValue?l.date(e.displayValue):v.value.length>0?l.date(v.value[0]):e.min?l.date(e.min):Array.isArray(e.allowedDates)?l.date(e.allowedDates[0]):l.date()),t=xe(e,"year",void 0,b=>{const w=b!=null?Number(b):l.getYear(s.value);return l.startOfYear(l.setYear(l.date(),w))},b=>l.getYear(b)),g=xe(e,"month",void 0,b=>{const w=b!=null?Number(b):l.getMonth(s.value),T=l.setYear(l.startOfMonth(l.date()),l.getYear(t.value));return l.setMonth(T,w)},b=>l.getMonth(b)),r=d(()=>e.firstDayOfWeek??e.weekdays[0]),h=d(()=>{const b=Number(e.firstDayOfWeek??0);return e.weekdays.map(w=>(w+b)%7)}),a=d(()=>{const b=l.getWeekArray(g.value,r.value),w=b.flat(),T=6*7;if(e.weeksInMonth==="static"&&w.length<T){const H=w[w.length-1];let y=[];for(let E=1;E<=T-w.length;E++)y.push(l.addDays(H,E)),E%7===0&&(b.push(y),y=[])}return b});function i(b,w){return b.filter(T=>h.value.includes(l.toJsDate(T).getDay())).map((T,H)=>{const y=l.toISO(T),E=!l.isSameMonth(T,g.value),N=l.isSameDay(T,l.startOfMonth(g.value)),W=l.isSameDay(T,l.endOfMonth(g.value)),le=l.isSameDay(T,g.value);return{date:T,isoDate:y,formatted:l.format(T,"keyboardDate"),year:l.getYear(T),month:l.getMonth(T),isDisabled:j(T),isWeekStart:H%7===0,isWeekEnd:H%7===6,isToday:l.isSameDay(T,w),isAdjacent:E,isHidden:E&&!e.showAdjacentMonths,isStart:N,isSelected:v.value.some(Q=>l.isSameDay(T,Q)),isEnd:W,isSame:le,localized:l.format(T,"dayOfMonth")}})}const c=d(()=>{const b=l.startOfWeek(s.value,e.firstDayOfWeek),w=[];for(let H=0;H<=6;H++)w.push(l.addDays(b,H));const T=l.date();return i(w,T)}),u=d(()=>{const b=a.value.flat(),w=l.date();return i(b,w)}),x=d(()=>a.value.map(b=>b.length?Ta(l,b[0]):null));function j(b){if(e.disabled)return!0;const w=l.date(b);return e.min&&l.isAfter(l.date(e.min),w)||e.max&&l.isAfter(w,l.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(T=>l.isSameDay(l.date(T),w)):typeof e.allowedDates=="function"?!e.allowedDates(w):!1}return{displayValue:s,daysInMonth:u,daysInWeek:c,genDays:i,model:v,weeksInMonth:a,weekDays:h,weekNumbers:x}}const Xt=Se({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ye(Bl(),["displayValue"])},"VDatePickerMonth"),At=we()({name:"VDatePickerMonth",props:Xt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=_(),{daysInMonth:g,model:r,weekNumbers:h}=Al(e),a=Le(),i=$e(),c=$e(),u=$e(!1),x=d(()=>u.value?e.reverseTransition:e.transition);e.multiple==="range"&&r.value.length>0&&(i.value=r.value[0],r.value.length>1&&(c.value=r.value[r.value.length-1]));const j=d(()=>{const H=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return r.value.length>=H});ye(g,(H,y)=>{y&&(u.value=a.isBefore(H[0].date,y[0].date))});function b(H){const y=a.startOfDay(H);if(r.value.length===0?i.value=void 0:r.value.length===1&&(i.value=r.value[0],c.value=void 0),!i.value)i.value=y,r.value=[i.value];else if(c.value)i.value=H,c.value=void 0,r.value=[i.value];else{if(a.isSameDay(y,i.value)){i.value=void 0,r.value=[];return}else a.isBefore(y,i.value)?(c.value=a.endOfDay(i.value),i.value=y):c.value=a.endOfDay(y);const E=a.getDiff(c.value,i.value,"days"),N=[i.value];for(let W=1;W<E;W++){const le=a.addDays(i.value,W);N.push(le)}N.push(c.value),r.value=N}}function w(H){const y=r.value.findIndex(E=>a.isSameDay(E,H));if(y===-1)r.value=[...r.value,H];else{const E=[...r.value];E.splice(y,1),r.value=E}}function T(H){e.multiple==="range"?b(H):e.multiple?w(H):r.value=[H]}return()=>o("div",{class:"v-date-picker-month"},[e.showWeek&&o("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&o("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[ct(" ")]),h.value.map(H=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[H]))]),o(Gt,{name:x.value},{default:()=>{var H;return[o("div",{ref:t,key:(H=g.value[0].date)==null?void 0:H.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&a.getWeekdays(e.firstDayOfWeek).map(y=>o("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[y])),g.value.map((y,E)=>{const N={props:{onClick:()=>T(y.date)},item:y,i:E};return j.value&&!y.isSelected&&(y.isDisabled=!0),o("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":y.isAdjacent,"v-date-picker-month__day--hide-adjacent":y.isHidden,"v-date-picker-month__day--selected":y.isSelected,"v-date-picker-month__day--week-end":y.isWeekEnd,"v-date-picker-month__day--week-start":y.isWeekStart}],"data-v-date":y.isDisabled?void 0:y.isoDate},[(e.showAdjacentMonths||!y.isAdjacent)&&o(Ze,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(y.isSelected||y.isToday)&&!y.isDisabled?e.color:void 0,disabled:y.isDisabled,icon:!0,ripple:!1,text:y.localized,variant:y.isDisabled?y.isToday?"outlined":"text":y.isToday&&!y.isSelected?"outlined":"flat",onClick:()=>T(y.date)}}},{default:()=>{var W;return[((W=s.day)==null?void 0:W.call(s,N))??o(K,N.props,null)]}})])})])]}})])}}),qt=Se({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),Ot=we()({name:"VDatePickerMonths",props:qt(),emits:{"update:modelValue":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=Le(),g=xe(e,"modelValue"),r=d(()=>{let h=t.startOfYear(t.date());return e.year&&(h=t.setYear(h,e.year)),Nt(12).map(a=>{const i=t.format(h,"monthShort"),c=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),h)||e.max&&t.isAfter(h,t.startOfMonth(t.date(e.max))));return h=t.getNextMonth(h),{isDisabled:c,text:i,value:a}})});return Wt(()=>{g.value=g.value??t.getMonth(t.date())}),He(()=>o("div",{class:"v-date-picker-months",style:{height:Ut(e.height)}},[o("div",{class:"v-date-picker-months__content"},[r.value.map((h,a)=>{var u;const i={active:g.value===a,color:g.value===a?e.color:void 0,disabled:h.isDisabled,rounded:!0,text:h.text,variant:g.value===h.value?"flat":"text",onClick:()=>c(a)};function c(x){if(g.value===x){v("update:modelValue",g.value);return}g.value=x}return((u=s.month)==null?void 0:u.call(s,{month:h,i:a,props:i}))??o(K,me({key:"month"},i),null)})])])),{}}}),Kt=Se({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),Rt=we()({name:"VDatePickerYears",props:Kt(),emits:{"update:modelValue":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=Le(),g=xe(e,"modelValue"),r=d(()=>{const a=t.getYear(t.date());let i=a-100,c=a+52;e.min&&(i=t.getYear(t.date(e.min))),e.max&&(c=t.getYear(t.date(e.max)));let u=t.startOfYear(t.date());return u=t.setYear(u,i),Nt(c-i+1,i).map(x=>{const j=t.format(u,"year");return u=t.setYear(u,t.getYear(u)+1),{text:j,value:x}})});Wt(()=>{g.value=g.value??t.getYear(t.date())});const h=wa();return Je(async()=>{var a;await Ce(),(a=h.el)==null||a.scrollIntoView({block:"center"})}),He(()=>o("div",{class:"v-date-picker-years",style:{height:Ut(e.height)}},[o("div",{class:"v-date-picker-years__content"},[r.value.map((a,i)=>{var u;const c={ref:g.value===a.value?h:void 0,active:g.value===a.value,color:g.value===a.value?e.color:void 0,rounded:!0,text:a.text,variant:g.value===a.value?"flat":"text",onClick:()=>{if(g.value===a.value){v("update:modelValue",g.value);return}g.value=a.value}};return((u=s.year)==null?void 0:u.call(s,{year:a,i,props:c}))??o(K,me({key:"month"},c),null)})])])),{}}}),Ol=za("v-picker-title"),Qt=Se({color:String,...Na(),...La(),...Ea(),...Ya(),...$a(),...Ra(),...Oa(),...Aa(),...Ba()},"VSheet"),$t=we()({name:"VSheet",props:Qt(),setup(e,l){let{slots:v}=l;const{themeClasses:s}=Pa(e),{backgroundColorClasses:t,backgroundColorStyles:g}=vt(Ft(e,"color")),{borderClasses:r}=Ca(e),{dimensionStyles:h}=xa(e),{elevationClasses:a}=Ha(e),{locationStyles:i}=Ma(e),{positionClasses:c}=Va(e),{roundedClasses:u}=Ia(e);return He(()=>o(e.tag,{class:["v-sheet",s.value,t.value,r.value,a.value,c.value,u.value,e.class],style:[g.value,h.value,i.value,e.style]},v)),{}}}),Jt=Se({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...Qt()},"VPicker"),Yt=we()({name:"VPicker",props:Jt(),setup(e,l){let{slots:v}=l;const{backgroundColorClasses:s,backgroundColorStyles:t}=vt(Ft(e,"color"));return He(()=>{const g=$t.filterProps(e),r=!!(e.title||v.title);return o($t,me(g,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var h;return[!e.hideHeader&&o("div",{key:"header",class:[s.value],style:[t.value]},[r&&o(Ol,{key:"picker-title"},{default:()=>{var a;return[((a=v.title)==null?void 0:a.call(v))??e.title]}}),v.header&&o("div",{class:"v-picker__header"},[v.header()])]),o("div",{class:"v-picker__body"},[(h=v.default)==null?void 0:h.call(v)]),v.actions&&o(Ze,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[o("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),Rl=Se({header:{type:String,default:"$vuetify.datePicker.header"},...zt(),...Xt({weeksInMonth:"static"}),...Ye(qt(),["modelValue"]),...Ye(Kt(),["modelValue"]),...Jt({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Et=we()({name:"VDatePicker",props:Rl(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,l){let{emit:v,slots:s}=l;const t=Le(),{t:g}=Wa(),r=xe(e,"modelValue",void 0,k=>qe(k).map(B=>t.date(B)),k=>e.multiple?k:k[0]),h=xe(e,"viewMode"),a=d(()=>{const k=t.date(e.min);return e.min&&t.isValid(k)?k:null}),i=d(()=>{const k=t.date(e.max);return e.max&&t.isValid(k)?k:null}),c=d(()=>{var R;const k=t.date();let B=k;return(R=r.value)!=null&&R[0]?B=t.date(r.value[0]):a.value&&t.isBefore(k,a.value)?B=a.value:i.value&&t.isAfter(k,i.value)&&(B=i.value),B&&t.isValid(B)?B:k}),u=_(Number(e.month??t.getMonth(t.startOfMonth(c.value)))),x=_(Number(e.year??t.getYear(t.startOfYear(t.setMonth(c.value,u.value))))),j=$e(!1),b=d(()=>e.multiple&&r.value.length>1?g("$vuetify.datePicker.itemsSelected",r.value.length):r.value[0]&&t.isValid(r.value[0])?t.format(t.date(r.value[0]),"normalDateWithWeekday"):g(e.header)),w=d(()=>{let k=t.date();return k=t.setDate(k,1),k=t.setMonth(k,u.value),k=t.setYear(k,x.value),t.format(k,"monthAndYear")}),T=d(()=>`date-picker-header${j.value?"-reverse":""}-transition`),H=d(()=>{if(e.disabled)return!0;const k=[];if(h.value!=="month")k.push("prev","next");else{let B=t.date();if(B=t.startOfMonth(B),B=t.setMonth(B,u.value),B=t.setYear(B,x.value),a.value){const R=t.addDays(t.startOfMonth(B),-1);t.isAfter(a.value,R)&&k.push("prev")}if(i.value){const R=t.addDays(t.endOfMonth(B),1);t.isAfter(R,i.value)&&k.push("next")}}return k});function y(){u.value<11?u.value++:(x.value++,u.value=0,z(x.value)),Q(u.value)}function E(){u.value>0?u.value--:(x.value--,u.value=11,z(x.value)),Q(u.value)}function N(){h.value="month"}function W(){h.value=h.value==="months"?"month":"months"}function le(){h.value=h.value==="year"?"month":"year"}function Q(k){h.value==="months"&&W(),v("update:month",k)}function z(k){h.value==="year"&&le(),v("update:year",k)}return ye(r,(k,B)=>{const R=qe(B),G=qe(k);if(!G.length)return;const ne=t.date(R[R.length-1]),ee=t.date(G[G.length-1]),J=t.getMonth(ee),L=t.getYear(ee);J!==u.value&&(u.value=J,Q(u.value)),L!==x.value&&(x.value=L,z(x.value)),j.value=t.isBefore(ne,ee)}),He(()=>{const k=Yt.filterProps(e),B=It.filterProps(e),R=Bt.filterProps(e),G=At.filterProps(e),ne=Ye(Ot.filterProps(e),["modelValue"]),ee=Ye(Rt.filterProps(e),["modelValue"]),J={header:b.value,transition:T.value};return o(Yt,me(k,{class:["v-date-picker",`v-date-picker--${h.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var L;return((L=s.title)==null?void 0:L.call(s))??o("div",{class:"v-date-picker__title"},[g(e.title)])},header:()=>s.header?o(Ze,{defaults:{VDatePickerHeader:{...J}}},{default:()=>{var L;return[(L=s.header)==null?void 0:L.call(s,J)]}}):o(Bt,me({key:"header"},R,J,{onClick:h.value!=="month"?N:void 0}),{...s,default:void 0}),default:()=>o(De,null,[o(It,me(B,{disabled:H.value,text:w.value,"onClick:next":y,"onClick:prev":E,"onClick:month":W,"onClick:year":le}),null),o(Xa,{hideOnLeave:!0},{default:()=>[h.value==="months"?o(Ot,me({key:"date-picker-months"},ne,{modelValue:u.value,"onUpdate:modelValue":[L=>u.value=L,Q],min:a.value,max:i.value,year:x.value}),null):h.value==="year"?o(Rt,me({key:"date-picker-years"},ee,{modelValue:x.value,"onUpdate:modelValue":[L=>x.value=L,z],min:a.value,max:i.value}),null):o(At,me({key:"date-picker-month"},G,{modelValue:r.value,"onUpdate:modelValue":L=>r.value=L,month:u.value,"onUpdate:month":[L=>u.value=L,Q],year:x.value,"onUpdate:year":[L=>x.value=L,z],min:a.value,max:i.value}),null)]})]),actions:s.actions})}),{}}}),$l={class:"route-container"},Yl={class:"timetable-controls"},El={class:"timetable-controls__date"},Ll={key:0,class:"timetable-controls-mobile"},Nl={class:"timetable-controls-mobile__date"},Wl=Ie({__name:"TimeTable",setup(e){Ee();const l=Ne(),v=_(null),s=ga(),t=d(()=>s.server_settings),g=d(()=>t.value.general.backend==="EDCB"),r=_(!1),h=_(!1),a=_(0),i=_(!1),c=_(null),u=_(null),x=_(null),j=_(!1),b=d(()=>{const D=[],p=l.available_channel_types;for(const I of jt)p.has(I)&&D.push({title:I,value:I});return D}),w=d({get:()=>l.selected_channel_type,set:D=>{l.changeChannelType(D)}}),T=d(()=>{const D=[];for(let p=4;p<=24;p+=4){const I=p;D.push({title:`${I.toString().padStart(2,"0")}時`,value:p})}return D});function H(){let p=F().hour();return p<4&&(p+=24),Math.floor((p-4)/4)*4+4}const y=_(H()),E=d(()=>{const D=l.selected_date.add(a.value,"day"),p=D.month()+1,I=D.date(),ie=["日","月","火","水","木","金","土"][D.day()];return`${p}/${I} (${ie})`}),N=d({get:()=>l.selected_date.toDate(),set:D=>{const p=F(D).hour(4).minute(0).second(0).millisecond(0);l.changeDate(p)}}),W=d(()=>l.date_range===null?!1:l.selected_date.subtract(1,"day").isSameOrAfter(l.date_range.earliest,"day")),le=d(()=>l.date_range===null?!1:l.selected_date.add(1,"day").isSameOrBefore(l.date_range.latest,"day")),Q=d(()=>{if(l.date_range!==null)return l.date_range.earliest.toDate()}),z=d(()=>{if(l.date_range!==null)return l.date_range.latest.toDate()});function k(D){l.changeChannelType(D)}function B(D){h.value=!1;const p=F(D).hour(4).minute(0).second(0).millisecond(0);l.changeDate(p)}function R(D){D===null||v.value===null||v.value.scrollToHour(D)}async function G(){await l.goToPreviousDay(),await Ce(),v.value!==null&&v.value.scrollToEnd()}async function ne(){await l.goToNextDay(),await Ce(),v.value!==null&&v.value.scrollToStart()}async function ee(){await l.goToCurrentTime(),await Ce(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function J(D){l.updateScrollPosition(D.x,D.y)}function L(D){const p=Math.floor((D-4)/4)*4+4,I=Math.max(4,Math.min(24,p));y.value=I}function _e(D){a.value=D}function he(D){l.selectProgram(D)}async function C(D,p,I){const ie=F(I.end_time);if(j.value=ie.isBefore(F()),I.reservation!==null){const M=await Ue.fetchReservation(I.reservation.id);M!==null?(c.value=M,u.value=null,x.value=null):(c.value=m(I,p.channel),u.value=null,x.value=null)}else c.value=m(I,p.channel),u.value=null,x.value=null;i.value=!0}function m(D,p){return{id:-1,channel:p,program:D,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(wt)}}async function S(){await l.fetchTimeTableData()}async function $(){await l.fetchTimeTableData()}async function ae(){await l.fetchTimeTableData()}async function se(D,p,I){if(F(I.end_time).isBefore(F()))return;if(g.value===!1){rt.warning("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}if(I.reservation!==null){const be=await Ue.fetchReservation(I.reservation.id);if(be===null)return;const X=structuredClone(be.record_settings);if(X.is_enabled=!X.is_enabled,await Ue.updateReservation(be.id,X)!==null){const re=X.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;rt.success(re),await l.fetchTimeTableData()}return}await Ue.addReservation(D,structuredClone(wt))&&(rt.success("録画予約を追加しました。"),await l.fetchTimeTableData())}return Je(async()=>{await s.fetchServerSettingsOnce(),await l.initialLoad()}),dt(()=>{l.reset()}),ye(()=>l.selected_date,()=>{a.value=0}),(D,p)=>{const I=Qe("Icon"),ie=Lt("ftooltip");return Y(),Z("div",$l,[o(fa,null,Ua({_:2},[pe(Re).isSmartphoneVertical()?void 0:{name:"timetable-controls",fn:q(()=>[O("div",Yl,[o(Ge,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:b.value,modelValue:w.value,"onUpdate:modelValue":[p[0]||(p[0]=M=>w.value=M),k]},null,8,["items","modelValue"]),O("div",El,[o(K,{variant:"flat",icon:"",size:"small",disabled:!W.value,onClick:G},{default:q(()=>[o(I,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),o(xt,{modelValue:h.value,"onUpdate:modelValue":p[2]||(p[2]=M=>h.value=M),"close-on-content-click":!1},{activator:q(({props:M})=>[o(K,me({variant:"flat",class:"timetable-controls__date-button"},M),{default:q(()=>[ct(Te(E.value),1)]),_:1},16)]),default:q(()=>[o(Et,{modelValue:N.value,"onUpdate:modelValue":[p[1]||(p[1]=M=>N.value=M),B],color:"primary",min:Q.value,max:z.value},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),o(K,{variant:"flat",icon:"",size:"small",disabled:!le.value,onClick:ne},{default:q(()=>[o(I,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),o(Ge,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:T.value,modelValue:y.value,"onUpdate:modelValue":[p[3]||(p[3]=M=>y.value=M),R]},null,8,["items","modelValue"]),ut((Y(),fe(K,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:ee},{default:q(()=>[o(I,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[ie,"現在時刻に移動",void 0,{bottom:!0}]]),ut((Y(),fe(K,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:p[4]||(p[4]=M=>r.value=!0)},{default:q(()=>[o(I,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[ie,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),O("main",null,[o(ha,{"icon-only":!pe(Re).isSmartphoneVertical()},null,8,["icon-only"]),O("div",{class:Ke(["timetable-container",{"timetable-container--loading":pe(l).is_loading}])},[o(_a),pe(Re).isSmartphoneVertical()?(Y(),Z("div",Ll,[o(Ge,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:b.value,modelValue:w.value,"onUpdate:modelValue":[p[5]||(p[5]=M=>w.value=M),k]},null,8,["items","modelValue"]),O("div",Nl,[o(xt,{modelValue:h.value,"onUpdate:modelValue":p[7]||(p[7]=M=>h.value=M),"close-on-content-click":!1},{activator:q(({props:M})=>[o(K,me({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},M),{default:q(()=>[ct(Te(E.value),1)]),_:1},16)]),default:q(()=>[o(Et,{modelValue:N.value,"onUpdate:modelValue":[p[6]||(p[6]=M=>N.value=M),B],color:"primary",min:Q.value,max:z.value},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),o(Ge,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:T.value,modelValue:y.value,"onUpdate:modelValue":[p[8]||(p[8]=M=>y.value=M),R]},null,8,["items","modelValue"]),o(K,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:ee},{default:q(()=>[o(I,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),o(K,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:p[9]||(p[9]=M=>r.value=!0)},{default:q(()=>[o(I,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])):ce("",!0),o(Vl,{ref_key:"timetableGridRef",ref:v,channels:pe(l).channels_data,selectedDate:pe(l).selected_date,isLoading:pe(l).is_loading,is36HourDisplay:pe(l).is_36hour_display,canGoPreviousDay:W.value,canGoNextDay:le.value,onScrollPositionChange:J,onTimeSlotChange:L,onDateDisplayOffsetChange:_e,onProgramSelect:he,onShowProgramDetail:C,onQuickReserve:se,onGoToNextDay:ne,onGoToPreviousDay:G},null,8,["channels","selectedDate","isLoading","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),o(ya,{isOpen:r.value,"onUpdate:isOpen":p[10]||(p[10]=M=>r.value=M)},null,8,["isOpen"]),o(pa,{modelValue:i.value,"onUpdate:modelValue":p[11]||(p[11]=M=>i.value=M),reservation:c.value,program:u.value,channel:x.value,isPastProgram:j.value,onAdded:S,onUpdated:$,onDeleted:ae},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),on=Be(Wl,[["__scopeId","data-v-e5b16730"]]);export{on as default};
