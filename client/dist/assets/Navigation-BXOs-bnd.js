import{V as W,_ as z,u as H}from"./ssrBoot-DJFlLNSd.js";import{d as L,O as R,S as G,r as y,o as _,c as I,w as g,j as f,h as d,b as o,k as F,L as j,V as B,i as U,R as p,p as E,q as V,e as u,_ as x,z as q,cI as K,A as M,ci as O,cw as Y,cv as J,dv as Q,B as X,dh as Z,cn as tt,C as et,dw as nt,cN as at,ck as st,bE as w,cj as it,cz as ot,cB as rt,D as S,dx as lt,cq as ct,cl as ut,c9 as vt,dy as _t,cc as N,n as h,G as A,I as dt,U as $,m as ht,a as ft,t as gt}from"./index-DSk2iuP-.js";function pt(t,s,e,r){function l(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function c(v){try{a(r.next(v))}catch(k){i(k)}}function m(v){try{a(r.throw(v))}catch(k){i(k)}}function a(v){v.done?n(v.value):l(v.value).then(c,m)}a((r=r.apply(t,[])).next())})}function mt(t,s){var e={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},r,l,n,i;return i={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(a){return function(v){return m([a,v])}}function m(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(e=0)),e;)try{if(r=1,l&&(n=a[0]&2?l.return:a[0]?l.throw||((n=l.return)&&n.call(l),0):l.next)&&!(n=n.call(l,a[1])).done)return n;switch(l=0,n&&(a=[a[0]&2,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,l=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(n=e.trys,!(n=n.length>0&&n[n.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!n||a[1]>n[0]&&a[1]<n[3])){e.label=a[1];break}if(a[0]===6&&e.label<n[1]){e.label=n[1],n=a;break}if(n&&e.label<n[2]){e.label=n[2],e.ops.push(a);break}n[2]&&e.ops.pop(),e.trys.pop();continue}a=s.call(t,e)}catch(v){a=[6,v],l=0}finally{r=n=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}var kt=function(){function t(){var s=this;this.event=null,this.callbacks=[],this.install=function(){return pt(s,void 0,void 0,function(){var e=this;return mt(this,function(r){switch(r.label){case 0:return this.event?(this.event.prompt(),[4,this.event.userChoice.then(function(l){var n=l.outcome;return e.updateEvent(null),n==="accepted"||!0})]):[3,2];case 1:return[2,r.sent()];case 2:throw new Error("Not allowed to prompt.")}})})},!(typeof window>"u")&&(window.addEventListener("beforeinstallprompt",function(e){e.preventDefault(),s.updateEvent(e)}),window.addEventListener("appinstalled",function(){s.updateEvent(null)}))}return t.prototype.getEvent=function(){return this.event},t.prototype.canInstall=function(){return this.event!==null},t.prototype.updateEvent=function(s){var e=this;s!==this.event&&(this.event=s,this.callbacks.forEach(function(r){return r(e.canInstall())}))},t.prototype.addListener=function(s){s(this.canInstall()),this.callbacks.push(s)},t.prototype.removeListener=function(s){this.callbacks=this.callbacks.filter(function(e){return s!==e})},t}(),P=new kt;const bt=t=>(E("data-v-f8470146"),t=t(),V(),t),yt={class:"header"},wt=bt(()=>u("img",{class:"konomitv-logo__image",src:z,height:"21"},null,-1)),St=L({__name:"HeaderBar",setup(t){const s=R(!1);return G(()=>{P.addListener(e=>{s.value=e})}),(e,r)=>{const l=y("router-link"),n=y("Icon");return _(),I("header",yt,[g((_(),f(l,{class:"konomitv-logo ml-3 ml-md-6",to:"/tv/"},{default:d(()=>[wt]),_:1})),[[p]]),o(W),s.value?(_(),f(B,{key:0,variant:"flat",color:"background-lighten-3",class:"pwa-install-button",onClick:r[0]||(r[0]=i=>j(P).install())},{default:d(()=>[o(n,{icon:"material-symbols:install-desktop-rounded",height:"20px",class:"mr-1"}),F(" アプリとしてインストール ")]),_:1})):U("",!0)])}}}),Jt=x(St,[["__scopeId","data-v-f8470146"]]),Ct=q({bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:t=>!t||["horizontal","shift"].includes(t)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...K(),...M(),...O(),...Y(),...J(),...Q({name:"bottom-navigation"}),...X({tag:"header"}),...Z({modelValue:!0,selectedClass:"v-btn--selected"}),...tt()},"VBottomNavigation"),Bt=et()({name:"VBottomNavigation",props:Ct(),emits:{"update:modelValue":t=>!0},setup(t,s){let{slots:e}=s;const{themeClasses:r}=nt(),{borderClasses:l}=at(t),{backgroundColorClasses:n,backgroundColorStyles:i}=st(w(t,"bgColor")),{densityClasses:c}=it(t),{elevationClasses:m}=ot(t),{roundedClasses:a}=rt(t),{ssrBootStyles:v}=H(),k=S(()=>Number(t.height)-(t.density==="comfortable"?8:0)-(t.density==="compact"?16:0)),C=w(t,"active"),{layoutItemStyles:T}=lt({id:t.name,order:S(()=>parseInt(t.order,10)),position:S(()=>"bottom"),layoutSize:S(()=>C.value?k.value:0),elementSize:k,active:C,absolute:w(t,"absolute")});return ct(t,_t),ut({VBtn:{color:w(t,"color"),density:w(t,"density"),stacked:S(()=>t.mode!=="horizontal"),variant:"text"}},{scoped:!0}),vt(()=>o(t.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":C.value,"v-bottom-navigation--grow":t.grow,"v-bottom-navigation--shift":t.mode==="shift"},r.value,n.value,l.value,c.value,m.value,a.value,t.class],style:[i.value,T.value,{height:N(k.value),transform:`translateY(${N(C.value?0:100,"%")})`},v.value,t.style]},{default:()=>[e.default&&o("div",{class:"v-bottom-navigation__content"},[e.default()])]})),{}}}),$t={},D=t=>(E("data-v-ff080838"),t=t(),V(),t),It=D(()=>u("span",{class:"mt-1"},"テレビをみる",-1)),Et=D(()=>u("span",{class:"mt-1"},"ビデオをみる",-1)),Vt=D(()=>u("span",{class:"mt-1"},"設定",-1));function xt(t,s){const e=y("Icon");return _(),f(Bt,{class:"bottom-navigation-container elevation-12",color:"primary",grow:"",active:""},{default:d(()=>[o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/tv")}]),to:"/tv/"},{default:d(()=>[o(e,{icon:"fluent:tv-20-regular",width:"30px"}),It]),_:1},8,["class"]),o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/videos")}]),to:"/videos/"},{default:d(()=>[o(e,{icon:"fluent:movies-and-tv-20-regular",width:"30px"}),Et]),_:1},8,["class"]),o(B,{class:h(["bottom-navigation-button",{"v-btn--active":t.$route.path.startsWith("/settings")}]),to:"/settings/"},{default:d(()=>[o(e,{icon:"fluent:settings-20-regular",width:"30px"}),Vt]),_:1},8,["class"])]),_:1})}const Dt=x($t,[["render",xt],["__scopeId","data-v-ff080838"]]);class Nt{static async fetchServerVersion(s=!1){const e=await A.get("/version");return e.type==="error"?(s===!1&&A.showGenericError(e,"バージョン情報を取得できませんでした。"),null):e.data}}const At=dt("version",{state:()=>({server_version_info:null,last_updated_at:0}),getters:{client_version(){return $.version},server_version(){var t;return((t=this.server_version_info)==null?void 0:t.version)??null},latest_version(){var t;return((t=this.server_version_info)==null?void 0:t.latest_version)??null},is_client_develop_version(){return this.client_version.includes("-dev")},is_server_develop_version(){var t;return((t=this.server_version)==null?void 0:t.includes("-dev"))??!1},is_update_available(){return this.server_version===null||this.latest_version===null?!1:this.is_server_develop_version===!1&&this.server_version!==this.latest_version||this.is_server_develop_version===!0&&this.server_version.replace("-dev","")===this.latest_version},is_version_mismatch(){return this.server_version===null?!1:this.client_version!==this.server_version}},actions:{async fetchServerVersion(t=!1){if(this.server_version_info!==null&&t===!1)return $.time()-this.last_updated_at>60&&this.fetchServerVersion(!0),this.server_version_info;const s=await Nt.fetchServerVersion();return s===null?null:(this.server_version_info=s,this.last_updated_at=$.time(),this.server_version_info)}}}),Pt=At,Wt=L({name:"Navigation",components:{BottomNavigation:Dt},computed:{...ht(Pt)},async created(){await this.versionStore.fetchServerVersion()}}),b=t=>(E("data-v-2980c68a"),t=t(),V(),t),Lt={class:"navigation-container elevation-8"},Tt={class:"navigation"},zt={class:"navigation-scroll"},Ht=b(()=>u("span",{class:"navigation__link-text"},"テレビをみる",-1)),Rt=b(()=>u("span",{class:"navigation__link-text"},"ビデオをみる",-1)),Gt=b(()=>u("span",{class:"navigation__link-text"},"番組表",-1)),Ft=b(()=>u("span",{class:"navigation__link-text"},"録画予約",-1)),jt=b(()=>u("span",{class:"navigation__link-text"},"マイリスト",-1)),Ut=b(()=>u("span",{class:"navigation__link-text"},"キャプチャ",-1)),qt=b(()=>u("span",{class:"navigation__link-text"},"設定",-1)),Kt={class:"navigation__link-text"};function Mt(t,s,e,r,l,n){const i=y("Icon"),c=y("router-link"),m=y("BottomNavigation"),a=ft("tooltip");return _(),I("div",null,[u("div",Lt,[u("nav",Tt,[u("div",zt,[g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/tv")}]),"active-class":"navigation__link--active",to:"/tv/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"fluent:tv-20-regular",width:"26px"}),Ht]),_:1},8,["class"])),[[p]]),g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/videos")}]),"active-class":"navigation__link--active",to:"/videos/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"fluent:movies-and-tv-20-regular",width:"26px"}),Rt]),_:1},8,["class"])),[[p]]),g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/timetable")}]),"active-class":"navigation__link--active",to:"/timetable/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"fluent:calendar-ltr-20-regular",width:"26px"}),Gt]),_:1},8,["class"])),[[p]]),g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/reserves")}]),"active-class":"navigation__link--active",to:"/reserves/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"fluent:timer-16-regular",width:"26px",style:{padding:"0.5px"}}),Ft]),_:1},8,["class"])),[[p]]),g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/mylist")}]),"active-class":"navigation__link--active",to:"/mylist/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"ic:round-playlist-play",width:"26px"}),jt]),_:1},8,["class"])),[[p]]),g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/captures")}]),"active-class":"navigation__link--active",to:"/captures/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"fluent:image-multiple-24-regular",width:"26px"}),Ut]),_:1},8,["class"])),[[p]]),o(W),g((_(),f(c,{class:h(["navigation__link",{"navigation__link--active":t.$route.path.startsWith("/settings")}]),"active-class":"navigation__link--active",to:"/settings/"},{default:d(()=>[o(i,{class:"navigation__link-icon",icon:"fluent:settings-20-regular",width:"26px"}),qt]),_:1},8,["class"])),[[p]]),g((_(),I("a",{class:h(["navigation__link",{"navigation__link--develop-version":t.versionStore.is_client_develop_version,"navigation__link--highlight":t.versionStore.is_update_available}]),"active-class":"navigation__link--active",href:"https://github.com/tsukumijima/KonomiTV"},[o(i,{class:"navigation__link-icon",icon:"fluent:info-16-regular",width:"26px"}),u("span",Kt,"version "+gt(t.versionStore.client_version),1)],2)),[[p],[a,t.versionStore.is_update_available?`アップデートがあります (version ${t.versionStore.latest_version})`:"",void 0,{top:!0}]])])])]),o(m)])}const Qt=x(Wt,[["render",Mt],["__scopeId","data-v-2980c68a"]]);export{Jt as H,Qt as N,Nt as V,Pt as u};
