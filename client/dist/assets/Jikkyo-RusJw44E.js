import{G as B,d as S,m as k,M as a,U as C,X as y,u as V,_ as U,r as A,o as _,j as $,h as d,e as u,w as N,c as m,b as i,k as s,V as F,i as E,t as f,n as T,R as I,p as P,q as R}from"./index-DSk2iuP-.js";import{C as j}from"./CommentMuteSettings-KM7eN_dS.js";import{S as M}from"./Base-hT6LaL4A.js";import{V as h}from"./VSwitch-MXTcKyiH.js";import{V as D}from"./VSlider-CZ7-oDHH.js";import"./VDialog-CwG58zwj.js";import"./VTextField-hUY0FbPz.js";import"./VAvatar-D8_Ah4cA.js";import"./VCard-B6D3O1BC.js";import"./ssrBoot-DJFlLNSd.js";import"./VSelect-NgOD9OVp.js";import"./Navigation-BXOs-bnd.js";class O{static async fetchAuthorizationURL(){const e=await B.get("/niconico/auth");return e.type==="error"?(B.showGenericError(e,"ニコニコアカウントとの連携用の認証 URL を取得できませんでした。"),null):e.data.authorization_url}static async logoutAccount(){const e=await B.delete("/niconico/logout");return e.type==="error"?(B.showGenericError(e,"ニコニコアカウントとの連携を解除できませんでした。"),!1):!0}}const b=O,L=S({name:"Settings-Jikkyo",components:{SettingsBase:M,CommentMuteSettings:j},data(){return{comment_mute_settings_modal:!1,is_loading:!0}},computed:{...k(V,y)},async created(){if(await this.userStore.fetchUser(),this.is_loading=!1,location.hash!==""){const t=new URLSearchParams(location.hash.replace("#",""));if(t.get("status")!==null&&t.get("detail")!==null){const e=parseInt(t.get("status")),r=t.get("detail");this.onOAuthCallbackReceived(e,r),history.replaceState(null,""," ")}}},methods:{async loginNiconicoAccount(){if(this.userStore.is_logged_in===!1){a.warning("連携をはじめるには、KonomiTV アカウントにログインしてください。");return}const t=await b.fetchAuthorizationURL();if(t===null)return;if(C.isMobileDevice()===!0){location.href=t;return}const e=window.open(t,"KonomiTV-OAuthPopup",C.getWindowFeatures());if(e===null){a.error("ポップアップウインドウを開けませんでした。");return}const r=async l=>{if(e.closed||C.typeof(l.data)!=="object"||!("KonomiTV-OAuthPopup"in l.data))return;e&&e.close(),window.removeEventListener("message",r);const g=l.data["KonomiTV-OAuthPopup"].status,p=l.data["KonomiTV-OAuthPopup"].detail;this.onOAuthCallbackReceived(g,p)};window.addEventListener("message",r)},async onOAuthCallbackReceived(t,e){if(console.log(`NiconicoAuthCallbackAPI: Status: ${t} / Detail: ${e}`),t!==200){if(e.startsWith("Authorization was denied (access_denied)"))a.error("ニコニコアカウントとの連携がキャンセルされました。");else if(e.startsWith("Failed to get access token (HTTP Error ")){const r=e.replace("Failed to get access token ","");a.error(`アクセストークンの取得に失敗しました。${r}`)}else if(e.startsWith("Failed to get access token (Connection Timeout)"))a.error("アクセストークンの取得に失敗しました。ニコニコで障害が発生している可能性があります。");else if(e.startsWith("Failed to get user information (HTTP Error ")){const r=e.replace("Failed to get user information ","");a.error(`ニコニコアカウントのユーザー情報の取得に失敗しました。${r}`)}else e.startsWith("Failed to get user information (Connection Timeout)")?a.error("ニコニコアカウントのユーザー情報の取得に失敗しました。ニコニコで障害が発生している可能性があります。"):a.error(`ニコニコアカウントとの連携に失敗しました。(${e})`);return}await this.userStore.fetchUser(!0),a.success("ニコニコアカウントと連携しました。")},async logoutNiconicoAccount(){await b.logoutAccount()!==!1&&(await this.userStore.fetchUser(!0),a.success("ニコニコアカウントとの連携を解除しました。"))}}}),o=t=>(P("data-v-2df3ab8c"),t=t(),R(),t),W={class:"settings__heading"},K=o(()=>u("span",{class:"ml-3"},"ニコニコ実況",-1)),J={key:0,class:"niconico-account niconico-account--anonymous"},z={class:"niconico-account-wrapper"},G=o(()=>u("div",{class:"niconico-account__info ml-4"},[u("div",{class:"niconico-account__info-name"},[u("span",{class:"niconico-account__info-name-text"},"ニコニコアカウントと連携していません")]),u("span",{class:"niconico-account__info-description"}," ニコニコアカウントと連携すると、テレビを見ながらニコニコ実況にコメントできるようになります。 ")],-1)),X={key:1,class:"niconico-account"},H={class:"niconico-account-wrapper"},q=["src"],Q={class:"niconico-account__info"},Y={class:"niconico-account__info-name"},Z={class:"niconico-account__info-name-text"},x={class:"niconico-account__info-description"},uu=o(()=>u("span",{class:"mr-2",style:{"white-space":"nowrap"}},"Niconico User ID:",-1)),tu=["href"],eu={key:0,class:"text-secondary"},su={class:"settings__item settings__item--switch"},ou=o(()=>u("label",{class:"settings__item-heading",for:"prefer_posting_to_nicolive"},"可能であればニコニコ実況へコメントする",-1)),iu=o(()=>u("label",{class:"settings__item-label",for:"prefer_posting_to_nicolive"},[s(" この設定がオンのときは、可能であれば "),u("a",{class:"link",href:"https://jk.nicovideo.jp",target:"_blank"},"ニコニコ実況"),s(" の各実況チャンネルにコメントを送信します。"),u("br"),s(" この設定がオフのときは、常に "),u("a",{class:"link",href:"https://nx-jikkyo.tsukumijima.net",target:"_blank"},"NX-Jikkyo"),s(" の各実況チャンネルにコメントを送信します。"),u("br")],-1)),nu=o(()=>u("label",{class:"settings__item-label mt-2",for:"prefer_posting_to_nicolive"},[s(" ニコニコ実況にコメントするには、ニコニコアカウントとの連携が必要です。"),u("br"),s(" ニコニコ実況に存在しない実況チャンネル (BS 民放など) やニコニコ実況のメンテナンス中は、この設定のオン/オフに関わらず、常に代わりに NX-Jikkyo にコメントします。 ")],-1)),au=o(()=>u("div",{class:"settings__item"},[u("div",{class:"settings__item-heading"},"コメントのミュート設定"),u("div",{class:"settings__item-label"},[s(" 表示したくないコメントを、映像上やコメントリストに表示しないようにミュートできます。"),u("br")]),u("div",{class:"settings__item-label mt-2"},[s(" デフォルトでは、下記のミュート設定がオンになっています。"),u("br"),s(" これらのコメントも表示したい方は、適宜オフに設定してください。"),u("br"),u("ul",{class:"ml-5 mt-2"},[u("li",null,"露骨な表現を含むコメントをミュートする"),u("li",null,"ネガティブな表現、差別的な表現、政治的に偏った表現を含むコメントをミュートする"),u("li",null,"文字サイズが大きいコメントをミュートする")])])],-1)),ru=o(()=>u("span",{class:"ml-1"},"コメントのミュート設定を開く",-1)),cu=o(()=>u("div",{class:"settings__item-label mt-7",style:{"border-left":"3px solid rgb(var(--v-theme-text-darken-1))","padding-left":"12px"}},[s(" コメントの透明度は、プレイヤー下にある設定アイコン ⚙️ から変更できます。"),u("br")],-1)),lu={class:"settings__item"},_u=o(()=>u("div",{class:"settings__item-heading"},"コメントの速さ",-1)),Bu=o(()=>u("div",{class:"settings__item-label"},[s(" プレイヤーに流れるコメントの速さを設定します。"),u("br"),s(" たとえば 1.2 に設定すると、コメントが 1.2 倍速く流れます。"),u("br")],-1)),du={class:"settings__item"},mu=o(()=>u("div",{class:"settings__item-heading"},"コメントの文字サイズ",-1)),Cu=o(()=>u("div",{class:"settings__item-label"},[s(" プレイヤーに流れるコメントの文字サイズの基準値を設定します。"),u("br"),s(" 実際の文字サイズは画面サイズに合わせて調整されます。デフォルトの文字サイズは 34px です。"),u("br")],-1)),Au={class:"settings__item settings__item--switch"},Fu=o(()=>u("label",{class:"settings__item-heading",for:"close_comment_form_after_sending"},"コメント送信後にコメント入力フォームを閉じる",-1)),Eu=o(()=>u("label",{class:"settings__item-label",for:"close_comment_form_after_sending"},[s(" この設定をオンにすると、コメントを送信した後に、コメント入力フォームが自動で閉じるようになります。"),u("br"),s(" コメント入力フォームが表示されたままだと、大半のショートカットキーが文字入力と競合して使えなくなります。とくに理由がなければ、オンにしておくのがおすすめです。"),u("br")],-1));function gu(t,e,r,l,g,p){const c=A("Icon"),v=A("CommentMuteSettings"),w=A("SettingsBase");return _(),$(w,null,{default:d(()=>[u("h2",W,[N((_(),m("a",{class:"settings__back-button",onClick:e[0]||(e[0]=n=>t.$router.back())},[i(c,{icon:"fluent:arrow-left-12-filled",width:"25px"})])),[[I]]),i(c,{icon:"bi:chat-left-text-fill",width:"19px"}),K]),u("div",{class:T(["settings__content",{"settings__content--loading":t.is_loading}])},[t.userStore.user===null||t.userStore.user.niconico_user_id===null?(_(),m("div",J,[u("div",z,[i(c,{class:"flex-shrink-0",icon:"bi:chat-left-text-fill",width:"45px"}),G]),i(F,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[1]||(e[1]=n=>t.loginNiconicoAccount())},{default:d(()=>[i(c,{icon:"fluent:plug-connected-20-filled",class:"mr-2",height:"26"}),s("連携する ")]),_:1})])):E("",!0),t.userStore.user!==null&&t.userStore.user.niconico_user_id!==null?(_(),m("div",X,[u("div",H,[u("img",{class:"niconico-account__icon",src:t.userStore.user_niconico_icon_url??""},null,8,q),u("div",Q,[u("div",Y,[u("span",Z,f(t.userStore.user.niconico_user_name)+" と連携しています",1)]),u("span",x,[uu,u("a",{class:"link mr-2",href:`https://www.nicovideo.jp/user/${t.userStore.user.niconico_user_id}`,target:"_blank"},f(t.userStore.user.niconico_user_id),9,tu),t.userStore.user.niconico_user_premium===!0?(_(),m("span",eu,"(Premium)")):E("",!0)])])]),i(F,{class:"niconico-account__login ml-auto",color:"secondary",width:"130",height:"56",variant:"flat",onClick:e[2]||(e[2]=n=>t.logoutNiconicoAccount())},{default:d(()=>[i(c,{icon:"fluent:plug-disconnected-20-filled",class:"mr-2",height:"26"}),s("連携解除 ")]),_:1})])):E("",!0),u("div",su,[ou,iu,nu,i(h,{class:"settings__item-switch",color:"primary",id:"prefer_posting_to_nicolive","hide-details":"",modelValue:t.settingsStore.settings.prefer_posting_to_nicolive,"onUpdate:modelValue":e[3]||(e[3]=n=>t.settingsStore.settings.prefer_posting_to_nicolive=n)},null,8,["modelValue"])]),au,i(F,{class:"settings__save-button mt-4",variant:"flat",onClick:e[4]||(e[4]=n=>t.comment_mute_settings_modal=!t.comment_mute_settings_modal)},{default:d(()=>[i(c,{icon:"heroicons-solid:filter",height:"19px"}),ru]),_:1}),cu,u("div",lu,[_u,Bu,i(D,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:.1,min:.5,max:2,modelValue:t.settingsStore.settings.comment_speed_rate,"onUpdate:modelValue":e[5]||(e[5]=n=>t.settingsStore.settings.comment_speed_rate=n)},null,8,["modelValue"])]),u("div",du,[mu,Cu,i(D,{class:"settings__item-form",color:"primary","show-ticks":"always","thumb-label":"","hide-details":"",step:1,min:20,max:60,modelValue:t.settingsStore.settings.comment_font_size,"onUpdate:modelValue":e[6]||(e[6]=n=>t.settingsStore.settings.comment_font_size=n)},null,8,["modelValue"])]),u("div",Au,[Fu,Eu,i(h,{class:"settings__item-switch",color:"primary",id:"close_comment_form_after_sending","hide-details":"",modelValue:t.settingsStore.settings.close_comment_form_after_sending,"onUpdate:modelValue":e[7]||(e[7]=n=>t.settingsStore.settings.close_comment_form_after_sending=n)},null,8,["modelValue"])])],2),i(v,{modelValue:t.comment_mute_settings_modal,"onUpdate:modelValue":e[8]||(e[8]=n=>t.comment_mute_settings_modal=n)},null,8,["modelValue"])]),_:1})}const $u=U(L,[["render",gu],["__scopeId","data-v-2df3ab8c"]]);export{$u as default};
