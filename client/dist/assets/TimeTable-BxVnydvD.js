import{H as ya,N as _a,S as ba}from"./SPHeaderBar-3JL1wwYc.js";import{u as ka,R as Sa,a as Ge,I as Pt}from"./ReservationDetailDrawer-DF3AnwlB.js";import{T as ye,a as Ta}from"./TimeTableSettings-tjOx-Pff.js";import{d as Be,G as c,U as ge,w as dt,j as Lt,k as he,r as et,f as me,h as J,b as $,B as Ke,t as De,o as E,_ as Ie,ae as Da,u as Ye,q as k,af as $e,N as F,s as _e,ag as wa,x as tt,z as mt,c as Q,e as de,P as Ae,n as Ze,a as r,p as Ht,V as Z,a2 as xe,F as pe,g as Ve,ac as xa,ah as Mt,D as we,E as ke,O as Pe,X as Qe,ai as ft,aj as at,ak as Ca,al as Ne,T as Ce,am as Je,an as Pa,l as vt,Y as Ee,ao as zt,ap as Ut,Q as fe,aq as Ft,ar as Ha,as as Ma,at as Gt,au as Va,av as Ba,aw as Ia,ax as Ra,ay as Oa,az as Aa,aA as $a,I as Ea,aB as Ya,aC as Na,aD as Wa,aE as La,aF as za,J as Ua,aG as Fa,aH as Ga,aI as ja,M as ct}from"./index-BflmFaPm.js";import{u as qa,P as Xa}from"./ChannelsStore-DpAN_Bjx.js";import{c as je,d as Vt}from"./VSelect-dUkyCJJS.js";import{V as Ka,c as Qa}from"./ssrBoot-sp5-SY7L.js";import{M as jt}from"./VAvatar-xu1JbhM9.js";import{b as Ja}from"./VTextField-BJ9F_2mX.js";import"./VSwitch-Baw8QUSX.js";import"./VChip-BHIgwRtw.js";import"./VSlider-useUFiwC.js";import"./VDialog-CtQ5InC0.js";import"./VCard-BjSW_SRf.js";const Za={class:"timetable-channel-header__logo-wrapper"},el=["src","alt"],tl={class:"timetable-channel-header__info"},al={class:"timetable-channel-header__number"},ll={class:"timetable-channel-header__name"},nl=Be({__name:"TimeTableChannelHeader",props:{channel:{},width:{},height:{},resizeTrigger:{}},setup(e){const a=e,v=c(()=>Math.round(Math.min(46,Math.max(32,a.width*.27)))),s=c(()=>Math.round(v.value*(3/4))),t=c(()=>Math.min(14,Math.max(13,a.width*.06))),m=c(()=>(a.resizeTrigger,Math.min(13.5,Math.max(ge.isSmartphoneVertical()?10:12,a.width*.08)))),u=c(()=>`${a.channel.name} を視聴`);return(n,i)=>{const o=et("router-link"),f=Lt("ftooltip");return dt((E(),he(o,{class:"timetable-channel-header",to:`/tv/watch/${e.channel.display_channel_id}`,style:me({width:`${e.width}px`,height:`${e.height}px`,"--timetable-channel-logo-width":`${v.value}px`,"--timetable-channel-logo-height":`${s.value}px`,"--timetable-channel-number-size":`${t.value}px`,"--timetable-channel-name-size":`${m.value}px`})},{default:J(()=>[$("div",Za,[$("img",{class:"timetable-channel-header__logo",loading:"lazy",decoding:"async",src:`${Ke(ge).api_base_url}/channels/${e.channel.id}/logo`,alt:e.channel.name},null,8,el)]),$("div",tl,[$("span",al,De(e.channel.channel_number),1),$("span",ll,De(e.channel.name),1)])]),_:1},8,["to","style"])),[[f,u.value,void 0,{bottom:!0}]])}}}),il=Ie(nl,[["__scopeId","data-v-1617c32b"]]),qt=["ピン留め","地デジ","BS","CS","CATV","SKY","BS4K"],sl=new Map([["地デジ","GR"],["BS","BS"],["CS","CS"],["CATV","CATV"],["SKY","SKY"],["BS4K","BS4K"]]),We=Da("timetable",()=>{const e=Ye(),a=qa(),v=k(null),s=k(T()),t=$e([]),m=k(null),u=k(!1),n=k(!1),i=k(!1),o=k(0),f=k(null);function p(){const _=F(),R=T();if(s.value.isSame(R,"day")===!1)return!1;let d=_.hour();return d<4&&(d+=24),d>=17}function C(){const _=F(),R=T();if(s.value.isSame(R,"day")===!1)return null;const d=_.startOf("hour").subtract(1,"hour"),O=q();return d.isBefore(O)?O:d}function q(){return i.value?s.value.add(12,"hour"):s.value}function S(_){return _.subtract(1,"millisecond").subtract(4,"hour").startOf("day").add(4,"hour")}function T(){const _=F();let R=_.hour(4).minute(0).second(0).millisecond(0);return _.hour()<4&&(R=R.subtract(1,"day")),R}function x(_,R=!1){return R?_.add(36,"hour"):_.add(1,"day")}const P=c(()=>i.value?s.value.add(12,"hour"):s.value),y=c(()=>{const _=new Set;if(a.is_channels_list_initial_updated===!1)return _;for(const R of a.channels_list_with_pinned.keys()){if(R==="ピン留め"){const d=a.channels_list_with_pinned.get("ピン留め");if(d===void 0||d.length===0)continue}_.add(R)}return _});function z(){return v.value===null?G():y.value.has(v.value)?null:G()}function G(){if(y.value.has("ピン留め"))return"ピン留め";if(y.value.has("地デジ"))return"地デジ";for(const _ of qt)if(y.value.has(_))return _;return"地デジ"}async function j(_,R,d,O){i.value=p(),f.value=C();const A=_??q(),K=R??x(A,i.value),re=d??v.value??"地デジ",ce=re==="ピン留め"?O??e.settings.pinned_channel_ids:void 0,ie=sl.get(re),ne=await Xa.fetchTimeTable(A,K,ie,ce);return ne===null?!1:(t.value=ne.channels,m.value={earliest:F(ne.date_range.earliest),latest:F(ne.date_range.latest)},!0)}async function ee(){u.value=!0,n.value=!1;try{if(await a.update(),s.value=T(),v.value=G(),await j()===!1){u.value=!1;return}n.value=!0}finally{u.value=!1}}async function W(_){u.value=!0;try{s.value=_,await j()}finally{u.value=!1}}async function te(_){u.value=!0;try{v.value=_,await j()}finally{u.value=!1}}function b(){let R=F().hour();return R<4&&(R+=24),R>=17}async function B(){if(m.value===null)return;const _=T(),R=b();let d;if(i.value)d=s.value.subtract(1,"day");else if(R){const A=s.value.subtract(1,"day");A.isSame(_.add(1,"day"),"day")?d=_:d=A}else d=s.value.subtract(1,"day");const O=S(m.value.earliest);d.isBefore(O,"day")||await W(d)}async function Y(){if(m.value===null)return;let _;i.value?_=s.value.add(2,"day"):_=s.value.add(1,"day");const R=S(m.value.latest);_.isAfter(R,"day")||await W(_)}async function oe(){const _=T();s.value.isSame(_,"day")===!1&&await W(_)}function ve(_){o.value=_}const ae=c(()=>{if(m.value===null)return!1;const _=T(),R=b();let d;if(i.value)d=s.value.subtract(1,"day");else if(R){const A=s.value.subtract(1,"day");A.isSame(_.add(1,"day"),"day")?d=_:d=A}else d=s.value.subtract(1,"day");const O=S(m.value.earliest);return d.isSameOrAfter(O,"day")}),le=c(()=>{if(m.value===null)return!1;let _;i.value?_=s.value.add(2,"day"):_=s.value.add(1,"day");const R=S(m.value.latest);return _.isSameOrBefore(R,"day")});function L(){t.value=[],m.value=null,u.value=!1,n.value=!1,i.value=!1,o.value=0,f.value=null,v.value=null}return _e(()=>e.settings.pinned_channel_ids,async(_,R)=>{v.value==="ピン留め"&&n.value!==!1&&wa(_,R)===!1&&await j()},{deep:!0}),_e(()=>a.channels_list_with_pinned,async()=>{if(n.value===!1)return;const _=z();_!==null&&await te(_)},{deep:!0}),{selected_channel_type:v,selected_date:s,channels_data:t,date_range:m,is_loading:u,is_initial_load_completed:n,is_36hour_display:i,date_display_offset:o,scroll_top_limit_time:f,available_channel_types:y,display_start_time:P,can_go_previous_day:ae,can_go_next_day:le,getBroadcastDate:S,getTodayStartTime:T,getDayEndTime:x,getDisplayStartTime:q,setDateDisplayOffset:ve,fetchTimeTableData:j,initialLoad:ee,changeDate:W,changeChannelType:te,goToPreviousDay:B,goToNextDay:Y,goToCurrentTime:oe,reset:L}}),ol=Be({__name:"TimeTableCurrentTimeLine",props:{hourHeight:{},totalWidth:{},channelHeaderHeight:{}},setup(e){const a=e,v=We(),s=k(F());let t=null,m=null;const u=c(()=>{const i=s.value,o=v.getDisplayStartTime(),f=v.getDayEndTime(o,v.is_36hour_display);return i.isSameOrAfter(o)&&i.isBefore(f)}),n=c(()=>{if(!u.value)return 0;const i=v.getDisplayStartTime();return ye.calculateCurrentTimeY(s.value,i,a.hourHeight,a.channelHeaderHeight)-a.channelHeaderHeight});return tt(()=>{const i=F(),o=i.add(1,"minute").startOf("minute"),f=Math.max(0,o.valueOf()-i.valueOf());m=setTimeout(()=>{s.value=F(),t=setInterval(()=>{s.value=F()},60*1e3)},f)}),mt(()=>{m!==null&&clearTimeout(m),t!==null&&clearInterval(t)}),(i,o)=>u.value?(E(),Q("div",{key:0,class:"timetable-current-time-line",style:me({top:`${n.value}px`,width:`${e.totalWidth}px`})},[...o[0]||(o[0]=[$("div",{class:"timetable-current-time-line__indicator"},null,-1),$("div",{class:"timetable-current-time-line__line"},null,-1)])],4)):de("",!0)}}),rl=Ie(ol,[["__scopeId","data-v-0116f747"]]),ul={class:"timetable-program-cell__content"},cl={class:"timetable-program-cell__header"},dl={class:"timetable-program-cell__start-minute"},vl={key:0,class:"timetable-program-cell__reservation-icon"},ml={key:0,class:"timetable-program-cell__recording-icon"},fl=["innerHTML"],hl=["innerHTML"],gl={key:0,class:"timetable-program-cell__actions"},pl="fluent:timer-16-filled",yl="mdi:timer-pause-outline",_l=Be({__name:"TimeTableProgramCell",props:{program:{},channel:{},hourHeight:{},channelWidth:{},fullChannelWidth:{},viewportHeight:{},channelHeaderHeight:{},isScrollAtBottom:{type:Boolean},isSubchannel:{type:Boolean},isSplit:{type:Boolean},isSelected:{type:Boolean},isPast:{type:Boolean},is36HourDisplay:{type:Boolean},isNextReserved:{type:Boolean},resizeTrigger:{}},emits:["click","show-detail","quick-reserve"],setup(e,{emit:a}){const v=new Map;function s(d,O){const A=d.title,K=d.description;if(A===null||K===null)return Ae.decorateProgramInfo(d,O);const re=v.get(d.id);if(re===void 0||re.raw_title!==A||re.raw_description!==K){const ie=Ae.decorateProgramInfo(d,"title"),ne=Ae.decorateProgramInfo(d,"description");v.set(d.id,{raw_title:A,raw_description:K,title:ie,description:ne})}const ce=v.get(d.id);return ce===void 0?Ae.decorateProgramInfo(d,O):O==="title"?ce.title:ce.description}const t=e,m=a,u=Ye(),n=We(),i=k(!1),o=k(null),f=k(0),p=c(()=>(t.resizeTrigger,ge.isTouchDevice()?t.isSelected:t.isSelected||u.settings.timetable_hover_expand&&i.value)),C=c(()=>t.program.reservation!==null),q=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Recording"}),S=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.status)==="Disabled"}),T=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Partial"}),x=c(()=>{var d;return((d=t.program.reservation)==null?void 0:d.recording_availability)==="Unavailable"}),P=c(()=>u.settings.timetable_dim_shopping_programs===!1?!1:Ae.isShoppingProgram(t.program)),y=c(()=>x.value?"rgb(var(--v-theme-error))":T.value?"rgb(var(--v-theme-warning))":S.value?"rgb(var(--v-theme-text-darken-2))":"rgb(var(--v-theme-secondary))"),z=c(()=>S.value?yl:pl),G=c(()=>C.value?S.value?"mdi:timer-play-outline":"mdi:timer-pause-outline":"mdi:timer-plus-outline"),j=c(()=>{if(t.resizeTrigger,!C.value)return"録画予約";const d=u.settings.timetable_channel_width==="Narrow",O=u.settings.timetable_channel_width!=="Wide",A=ge.isSmartphoneVertical()&&O||(ge.isSmartphoneHorizontal()||ge.isTabletVertical())&&d;return S.value?A?"有効化":"予約を有効化":A?"無効化":"予約を無効化"}),ee=c(()=>F(t.program.start_time).minute().toString().padStart(2,"0")),W=c(()=>{var A,K;const d=(K=(A=t.program.genres)==null?void 0:A[0])==null?void 0:K.major;return ye.getGenreColors(d,u.settings.timetable_genre_colors).highlight}),te=c(()=>{var A,K;if(x.value)return"#f8d7da";if(T.value)return"#fff3cd";const d=(K=(A=t.program.genres)==null?void 0:A[0])==null?void 0:K.major;return ye.getGenreColors(d,u.settings.timetable_genre_colors).background}),b=c(()=>{const d=F(t.program.start_time),O=n.getDisplayStartTime();return ye.calculateProgramY(d,O,t.hourHeight,t.channelHeaderHeight)-t.channelHeaderHeight}),B=c(()=>(t.is36HourDisplay?36:24)*t.hourHeight),Y=c(()=>{const d=ye.calculateProgramHeight(t.program.duration,t.hourHeight);return b.value+d>B.value?Math.max(0,B.value-b.value):Math.max(d,20)}),oe=c(()=>{const d=t.fullChannelWidth??t.channelWidth,O=t.isSplit===!0&&t.channelWidth<d,A=p.value&&f.value>0?f.value:Y.value,K=t.isSubchannel&&O?t.channelWidth:0,re=p.value&&O?0:K,ce=p.value&&O?d:t.channelWidth,ie={top:`${b.value}px`,left:`${re}px`,width:`${ce}px`,minHeight:`${Y.value}px`,"--timetable-cell-height":`${A}px`,"--timetable-program-base-background":te.value,"--timetable-program-base-highlight":W.value};if(p.value||(ie.height=`${Y.value}px`),p.value&&t.viewportHeight>0&&t.isScrollAtBottom===!0){const ne=f.value>0?f.value:Y.value,Se=Math.max(0,B.value-t.viewportHeight),Te=Se+t.viewportHeight,H=b.value+ne,h=b.value+Y.value>=B.value-1;if(H>Te&&h){const V=H-Te,X=Math.max(0,b.value-Se),D=Math.min(V,X);D>0&&(ie.transform=`translateY(-${D}px)`)}}return ie}),ve=c(()=>s(t.program,"title")),ae=c(()=>s(t.program,"description"));function le(){m("click")}function L(){i.value=!0}function _(){i.value=!1}function R(){m("quick-reserve")}return _e(p,async d=>{if(d===!1){f.value=0;return}await xe(),o.value!==null&&(f.value=Math.max(o.value.getBoundingClientRect().height,Y.value))}),(d,O)=>{const A=et("Icon");return E(),Q("div",{class:Ze(["timetable-program-cell",{"timetable-program-cell--selected":e.isSelected,"timetable-program-cell--expanded":p.value,"timetable-program-cell--past":e.isPast,"timetable-program-cell--subchannel":e.isSubchannel,"timetable-program-cell--reserved":C.value,"timetable-program-cell--recording":q.value,"timetable-program-cell--partial":T.value,"timetable-program-cell--unavailable":x.value,"timetable-program-cell--disabled":S.value,"timetable-program-cell--shopping":P.value,"timetable-program-cell--next-reserved":C.value&&e.isNextReserved}]),ref_key:"cellRef",ref:o,style:me(oe.value),onClick:le,onMouseenter:L,onMouseleave:_},[O[2]||(O[2]=$("div",{class:"timetable-program-cell__highlight"},null,-1)),$("div",ul,[$("div",cl,[$("span",dl,De(ee.value),1),C.value?(E(),Q("div",vl,[r(A,{icon:z.value,width:"14px",style:me({color:y.value})},null,8,["icon","style"]),q.value?(E(),Q("div",ml)):de("",!0),T.value?(E(),he(A,{key:1,icon:"fluent:warning-16-filled",width:"12px",class:"timetable-program-cell__warning-icon"})):de("",!0),x.value?(E(),he(A,{key:2,icon:"fluent:dismiss-circle-16-filled",width:"12px",class:"timetable-program-cell__error-icon"})):de("",!0)])):de("",!0)]),$("div",{class:"timetable-program-cell__title",innerHTML:ve.value},null,8,fl),$("div",{class:"timetable-program-cell__description",innerHTML:ae.value},null,8,hl),p.value?(E(),Q("div",gl,[r(Z,{variant:"flat",size:"small",class:"timetable-program-cell__action-button",onClick:O[0]||(O[0]=Ht(K=>d.$emit("show-detail"),["stop"]))},{default:J(()=>[r(A,{icon:"fluent:info-12-regular",width:"16px"}),O[1]||(O[1]=$("span",null,"番組詳細",-1))]),_:1}),e.isPast?de("",!0):(E(),he(Z,{key:0,variant:"flat",size:"small",class:Ze(["timetable-program-cell__action-button",{"timetable-program-cell__action-button--reserved":C.value&&!S.value,"timetable-program-cell__action-button--disabled-reservation":S.value}]),onClick:Ht(R,["stop"])},{default:J(()=>[r(A,{icon:G.value,width:"16px"},null,8,["icon"]),$("span",null,De(j.value),1)]),_:1},8,["class"]))])):de("",!0)])],38)}}}),Bt=Ie(_l,[["__scopeId","data-v-74b796f8"]]),bl={class:"timetable-time-scale"},kl=["data-hour"],Sl={class:"timetable-time-scale__label"},Tl={key:0,class:"timetable-time-scale__date"},Dl={class:"timetable-time-scale__hour-number"},wl=Be({__name:"TimeTableTimeScale",props:{hourHeight:{},is36HourDisplay:{type:Boolean}},setup(e){const a=e,v=Ye(),s=We(),t=c(()=>{const i=a.is36HourDisplay?36:24,o=s.display_start_time,f=[];for(let p=0;p<i;p++)f.push(o.add(p,"hour"));return f});function m(i){const o=i.hour();return v.settings.use_28hour_clock&&o>=0&&o<=3?(o+24).toString().padStart(2,"0"):o.toString().padStart(2,"0")}function u(i){const o=i.hour(),f=s.display_start_time;return!([0,4,8,12,16,20].includes(o)===!1||a.is36HourDisplay&&o===4&&f.hour()===4)}function n(i){return`${i.month()+1}/${i.date()}`}return(i,o)=>(E(),Q("div",bl,[(E(!0),Q(pe,null,Ve(t.value,f=>(E(),Q("div",{class:"timetable-time-scale__hour",key:f.valueOf(),style:me({height:`${a.hourHeight}px`}),"data-hour":f.hour()},[$("div",Sl,[u(f)?(E(),Q("span",Tl,De(n(f)),1)):de("",!0),$("span",Dl,De(m(f)),1),o[0]||(o[0]=$("span",{class:"timetable-time-scale__hour-label"},"時",-1))])],12,kl))),128))]))}}),xl=Ie(wl,[["__scopeId","data-v-9e862920"]]),Cl={class:"timetable-grid__channel-headers"},Pl={class:"timetable-grid__content"},Hl=2,Ml=3,Vl=.5,Bl=60,Il=2,Rl=100,Ol=120,It=.95,qe=.5,Xe=5,Al=Be({__name:"TimeTableGrid",props:{channels:{},is36HourDisplay:{type:Boolean},canGoPreviousDay:{type:Boolean},canGoNextDay:{type:Boolean}},emits:["time-slot-change","date-display-offset-change","show-program-detail","quick-reserve","go-to-next-day","go-to-previous-day"],setup(e,{expose:a,emit:v}){const s=e,t=v,m=Ye(),u=We(),n=k(null),i=k(null),o=k(!1),f=k(!1);let p=0;const C=k(0),q=k(!1),S=k(0),T=k(0),x=k(0),P=k(0),y=k(null);let z=null,G=null;const j=k(0),ee=new Set;let W=null,te=null,b=null;const B=k(0);let Y=null;function oe(){Y!==null&&clearTimeout(Y),Y=window.setTimeout(()=>{B.value++,Y=null},Rl)}const ve=k(!1),ae=k(!1),le=k(!1),L=k(!1),_=k(null),R=k(0),d=k(0),O=k(0),A=k(0),K=k(!1),re=k(!1),ce=k(0),ie=k(0),ne=k(0),Se=k(0),Te=k(0),H=k(0),h=k(null),V=c(()=>(B.value,ye.getDeviceType())),X=c(()=>ye.getChannelWidth(m.settings.timetable_channel_width,V.value)),D=c(()=>ye.getHourHeight(m.settings.timetable_hour_height,V.value)),He=c(()=>V.value==="Smartphone"?Ml:Hl),se=c(()=>ye.getChannelHeaderHeight(X.value)),Le=c(()=>(B.value,ye.getTimeScaleWidth(V.value,ge.isSmartphoneVertical()))),ze=c(()=>s.channels.length*X.value),Ue=c(()=>(s.is36HourDisplay?36:24)*D.value);function ta(l){return l.subchannels===null||l.subchannels.length===0?!1:l.subchannels.some(g=>g.programs.length>0)}const lt=new Map,Re=new Map;function nt(l){if(l==null)return{start:0,end:0};const g=lt.get(l.id);if(g!==void 0)return g;const M={start:F(l.start_time).valueOf(),end:F(l.end_time).valueOf()};return lt.set(l.id,M),M}function ht(l,g){const M=nt(l);return g.some(w=>{const U=nt(w);return U.start<M.end&&U.end>M.start})}function it(l,g,M){const w=`${g.id}:${M?"sub":"main"}`,U=Re.get(w);if(U!==void 0)return U;const I=yt(l);if(I.length===0)return Re.set(w,!1),!1;if(M){const ue=ht(g,l.programs);return Re.set(w,ue),ue}const N=ht(g,I);return Re.set(w,N),N}function gt(l,g,M){return it(l,g,M)?X.value/2:X.value}function Me(l){const g=D.value*He.value;S.value=Math.max(0,l-g),T.value=l+C.value+g}function aa(l){const M=D.value*He.value*Vl,w=l+C.value;return C.value<=0||T.value===0||l<S.value+M||w>T.value-M?(Me(l),!0):!1}function pt(l){const g=nt(l),M=(g.start-j.value)/(1e3*60*60)*D.value;return(g.end-j.value)/(1e3*60*60)*D.value>=S.value&&M<=T.value}function la(l){return l.subchannels===null?[]:l.subchannels}function yt(l){return l.subchannels===null?[]:l.subchannels.flatMap(g=>g.programs)}function _t(l){return F(l.end_time).isBefore(F())}function bt(l,g,M){const w=M?yt(l):l.programs,U=F(g.end_time).valueOf(),I=w.find(N=>F(N.start_time).valueOf()===U);return I!==void 0&&I.reservation!==null}function kt(){if(n.value===null)return;x.value;const l=P.value;p=l;const g=n.value.clientHeight-se.value;C.value!==g&&(C.value=g);const M=n.value.scrollHeight-n.value.clientHeight,w=l>=M-1;q.value!==w&&(q.value=w),aa(l)&&Oe();const I=l>M-100&&s.canGoNextDay,N=l<100&&s.canGoPreviousDay;o.value!==I&&(o.value=I),f.value!==N&&(f.value=N);const ue=u.getDisplayStartTime(),be=Math.floor(l/D.value);let ot=ue.add(be,"hour").hour();ot<4&&(ot+=24);const ha=Math.floor((ot-4)/4)*4+4,rt=Math.max(4,Math.min(24,ha));if(z!==rt&&(t("time-slot-change",rt),z=rt),s.is36HourDisplay){const ga=m.settings.use_28hour_clock?4:0;let Fe=ue.hour(ga).minute(0).second(0).millisecond(0);Fe.isSameOrBefore(ue)&&(Fe=Fe.add(1,"day"));const pa=(Fe.valueOf()-ue.valueOf())/(1e3*60*60)*D.value,ut=l>=pa?1:0;G!==ut&&(t("date-display-offset-change",ut),G=ut)}else G!==0&&(t("date-display-offset-change",0),G=0);St()}function na(){y.value===null&&(y.value=requestAnimationFrame(()=>{y.value=null,kt()}))}function Oe(){b===null&&(b=requestAnimationFrame(()=>{b=null,Tt()}))}function St(){te===null&&(te=requestAnimationFrame(()=>{te=null,ia()}))}function Tt(){n.value!==null&&(W!==null&&(W.disconnect(),ee.clear()),W=new IntersectionObserver(l=>{for(const g of l){const M=g.target,w=g.rootBounds;if(w===null)continue;const U=g.intersectionRect.top<=w.top,I=g.intersectionRect.height<g.boundingClientRect.height,N=w.height<g.boundingClientRect.height;if(g.isIntersecting&&U&&(I||N))ee.add(M),M.classList.add("timetable-program-cell--fixed");else{ee.delete(M),M.classList.remove("timetable-program-cell--fixed");const be=M.querySelector(".timetable-program-cell__content");be!==null&&(be.style.paddingTop="")}}St()},{root:n.value,rootMargin:`-${se.value}px 0px 0px 0px`,threshold:[0,1]}),n.value.querySelectorAll(".timetable-program-cell").forEach(l=>{W==null||W.observe(l)}))}function ia(){if(n.value===null||ee.size===0)return;const l=n.value.getBoundingClientRect().top+se.value;ee.forEach(g=>{const M=g.querySelector(".timetable-program-cell__content");if(M===null)return;const w=g.getBoundingClientRect().top,U=l-w;if(U<=0){M.style.paddingTop="";return}const I=g.style.getPropertyValue("--timetable-cell-height"),N=I?Number.parseFloat(I):g.getBoundingClientRect().height,ue=Math.max(0,N-Bl),be=g.classList.contains("timetable-program-cell--reserved")?3:0,Ct=Math.min(U,ue);M.style.paddingTop=`${Il+Math.max(Ct-be,0)}px`})}function sa(){n.value!==null&&(x.value=n.value.scrollLeft,P.value=n.value.scrollTop,na())}function Dt(l){n.value!==null&&(h.value!==null&&(cancelAnimationFrame(h.value),h.value=null),l.deltaX!==0&&(l.preventDefault(),n.value.scrollLeft+=l.deltaX),l.shiftKey&&l.deltaY!==0?(l.preventDefault(),n.value.scrollLeft+=l.deltaY):l.deltaY!==0&&l.deltaX===0&&(l.preventDefault(),n.value.scrollTop+=l.deltaY))}function oa(l){if(l.pointerType!=="mouse"||ve.value||n.value===null)return;const g=l.target;g.closest(".v-btn")||g.closest("a")||(le.value=!0,ae.value=!1,K.value=!1,R.value=l.clientX,d.value=l.clientY,O.value=n.value.scrollLeft,A.value=n.value.scrollTop,h.value!==null&&(cancelAnimationFrame(h.value),h.value=null),ie.value=0,ne.value=0,Se.value=performance.now(),Te.value=l.clientX,H.value=l.clientY)}function ra(l){if(l.pointerType!=="mouse"||le.value===!1||n.value===null)return;const g=R.value-l.clientX,M=d.value-l.clientY;if((Math.abs(g)>Xe||Math.abs(M)>Xe)&&ae.value===!1&&n.value!==null&&(ae.value=!0,K.value=!0,n.value.setPointerCapture(l.pointerId),L.value=!0,_.value=l.pointerId),ae.value===!1)return;l.preventDefault(),(Math.abs(g)>Xe||Math.abs(M)>Xe)&&(K.value=!0),n.value.scrollLeft=O.value+g,n.value.scrollTop=A.value+M;const w=performance.now(),U=w-Se.value;if(U>0){const I=l.clientX-Te.value,N=l.clientY-H.value;ie.value=-I/U*16,ne.value=-N/U*16}Se.value=w,Te.value=l.clientX,H.value=l.clientY}function wt(l){if(l.pointerType==="mouse"&&le.value!==!1){if(le.value=!1,ae.value=!1,n.value!==null&&L.value&&_.value!==null)try{n.value.releasePointerCapture(_.value)}catch{}L.value=!1,_.value=null,K.value?(ca(),re.value=!0,ce.value=performance.now()):(re.value=!1,ce.value=0)}}function ua(l){if(re.value===!1)return;performance.now()-ce.value<=Ol&&(l.preventDefault(),l.stopPropagation()),re.value=!1}function ca(){if(n.value===null||Math.abs(ie.value)<qe&&Math.abs(ne.value)<qe)return;const l=()=>{if(n.value!==null){if(ie.value*=It,ne.value*=It,n.value.scrollLeft+=ie.value,n.value.scrollTop+=ne.value,Math.abs(ie.value)<qe&&Math.abs(ne.value)<qe){h.value=null;return}h.value=requestAnimationFrame(l)}};h.value=requestAnimationFrame(l)}function xt(l){i.value===l.id?i.value=null:i.value=l.id}function da(l){if(n.value===null)return;const M=u.getDisplayStartTime().hour();let U=(l===24?0:l)-M;U<0&&(U+=24);const I=U*D.value;n.value.scrollTo({top:I,behavior:"smooth"})}function va(){const l=u.scroll_top_limit_time;if(l===null)return 0;const g=u.getDisplayStartTime(),w=(l.valueOf()-g.valueOf())/(1e3*60*60);return Math.max(0,w*D.value)}function st(l=!0,g=!1){if(n.value===null)return;const M=F(),w=u.getDisplayStartTime(),U=va(),ue=(M.subtract(30,"minute").valueOf()-w.valueOf())/(1e3*60*60),be=Math.max(U,ue*D.value);if(g){n.value.scrollTo({top:be,behavior:l?"smooth":"instant"});return}if(U===0){n.value.scrollTo({top:0,behavior:"instant"});return}n.value.scrollTo({top:U,behavior:"instant"}),l&&setTimeout(()=>{n.value!==null&&n.value.scrollTo({top:be,behavior:"smooth"})},50)}function ma(){n.value!==null&&n.value.scrollTo({top:0,behavior:"instant"})}function fa(){if(n.value===null)return;const l=n.value.scrollHeight-n.value.clientHeight;n.value.scrollTo({top:l,behavior:"instant"})}return a({scrollToHour:da,scrollToCurrentTime:st,scrollToStart:ma,scrollToEnd:fa}),tt(async()=>{window.addEventListener("resize",oe),n.value!==null&&n.value.addEventListener("wheel",Dt,{passive:!1}),window.addEventListener("touchstart",()=>{ve.value=!0},{once:!0,passive:!0}),await xe(),n.value!==null&&(x.value=n.value.scrollLeft,P.value=n.value.scrollTop,kt(),Tt()),setTimeout(()=>{st(),Me(p)},100)}),xa(()=>{window.removeEventListener("resize",oe),Y!==null&&(clearTimeout(Y),Y=null),n.value!==null&&n.value.removeEventListener("wheel",Dt),y.value!==null&&cancelAnimationFrame(y.value),te!==null&&cancelAnimationFrame(te),b!==null&&cancelAnimationFrame(b),W!==null&&(W.disconnect(),W=null,ee.clear()),h.value!==null&&cancelAnimationFrame(h.value)}),mt(()=>{h.value!==null&&cancelAnimationFrame(h.value)}),_e(()=>s.channels,async(l,g)=>{lt.clear(),Re.clear(),Me(p),Oe(),g.length===0&&l.length>0&&(await xe(),setTimeout(()=>{st(),Oe()},100))},{deep:!1}),_e([D,C],()=>{Me(p),Oe()}),_e(se,()=>{Oe()}),_e(()=>u.display_start_time,l=>{j.value=l.valueOf()},{immediate:!0}),(l,g)=>{const M=et("Icon");return E(),Q("div",{class:"timetable-grid",style:me({"--timetable-channel-header-height":`${se.value}px`})},[$("div",{class:Ze(["timetable-grid__scroll-area",{"timetable-grid__scroll-area--dragging":ae.value}]),ref_key:"scrollAreaRef",ref:n,onScroll:sa,onPointerdown:oa,onPointermove:ra,onPointerup:wt,onPointercancel:wt,onClickCapture:ua},[$("div",{class:"timetable-grid__layout",style:me({width:`${Le.value+ze.value}px`,height:`${se.value+Ue.value}px`})},[$("div",{class:"timetable-grid__header-row",style:me({height:`${se.value}px`})},[$("div",{class:"timetable-grid__corner",style:me({width:`${Le.value}px`})},null,4),$("div",Cl,[(E(!0),Q(pe,null,Ve(e.channels,w=>(E(),he(il,{key:w.channel.id,channel:w.channel,width:X.value,height:se.value,resizeTrigger:B.value},null,8,["channel","width","height","resizeTrigger"]))),128))])],4),$("div",{class:"timetable-grid__body-row",style:me({height:`${Ue.value}px`})},[$("div",{class:"timetable-grid__time-scale",style:me({width:`${Le.value}px`})},[r(xl,{hourHeight:D.value,is36HourDisplay:s.is36HourDisplay},null,8,["hourHeight","is36HourDisplay"])],4),$("div",Pl,[(E(!0),Q(pe,null,Ve(e.channels,(w,U)=>(E(),Q("div",{class:"timetable-grid__channel-column",key:w.channel.id,style:me({left:`${U*X.value}px`,width:`${X.value}px`,height:`${Ue.value}px`})},[$("div",{class:"timetable-grid__channel-background",style:me({height:`${Ue.value}px`})},null,4),(E(!0),Q(pe,null,Ve(w.programs,I=>(E(),Q(pe,{key:I.id},[pt(I)?(E(),he(Bt,{key:0,program:I,channel:w.channel,hourHeight:D.value,channelWidth:gt(w,I,!1),fullChannelWidth:X.value,isSplit:it(w,I,!1),viewportHeight:C.value,channelHeaderHeight:se.value,isScrollAtBottom:q.value,isSelected:i.value===I.id,isPast:_t(I),is36HourDisplay:s.is36HourDisplay,isNextReserved:bt(w,I,!1),resizeTrigger:B.value,onClick:N=>xt(I),onShowDetail:N=>l.$emit("show-program-detail",I.id,w.channel,I),onQuickReserve:N=>l.$emit("quick-reserve",I.id,w.channel,I)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128)),ta(w)?(E(!0),Q(pe,{key:0},Ve(la(w),I=>(E(),Q(pe,{key:I.channel.id},[(E(!0),Q(pe,null,Ve(I.programs,N=>(E(),Q(pe,{key:N.id},[pt(N)?(E(),he(Bt,{key:0,program:N,channel:I.channel,hourHeight:D.value,channelWidth:gt(w,N,!0),fullChannelWidth:X.value,isSplit:it(w,N,!0),viewportHeight:C.value,channelHeaderHeight:se.value,isScrollAtBottom:q.value,isSubchannel:!0,isSelected:i.value===N.id,isPast:_t(N),is36HourDisplay:s.is36HourDisplay,isNextReserved:bt(w,N,!0),resizeTrigger:B.value,onClick:ue=>xt(N),onShowDetail:ue=>l.$emit("show-program-detail",N.id,I.channel,N),onQuickReserve:ue=>l.$emit("quick-reserve",N.id,I.channel,N)},null,8,["program","channel","hourHeight","channelWidth","fullChannelWidth","isSplit","viewportHeight","channelHeaderHeight","isScrollAtBottom","isSelected","isPast","is36HourDisplay","isNextReserved","resizeTrigger","onClick","onShowDetail","onQuickReserve"])):de("",!0)],64))),128))],64))),128)):de("",!0)],4))),128)),r(rl,{hourHeight:D.value,totalWidth:ze.value,channelHeaderHeight:se.value},null,8,["hourHeight","totalWidth","channelHeaderHeight"])])],4)],4)],34),r(Mt,{name:"fade"},{default:J(()=>[o.value?(E(),he(Z,{key:0,class:"timetable-grid__next-day-button",variant:"elevated",color:"background-lighten-1",onClick:g[0]||(g[0]=w=>l.$emit("go-to-next-day"))},{default:J(()=>[r(M,{icon:"fluent:chevron-down-20-regular",width:"20px"}),g[2]||(g[2]=$("span",null,"次の日を見る",-1))]),_:1})):de("",!0)]),_:1}),r(Mt,{name:"fade"},{default:J(()=>[f.value?(E(),he(Z,{key:0,class:"timetable-grid__prev-day-button",variant:"elevated",color:"background-lighten-1",onClick:g[1]||(g[1]=w=>l.$emit("go-to-previous-day"))},{default:J(()=>[r(M,{icon:"fluent:chevron-up-20-regular",width:"20px"}),g[3]||(g[3]=$("span",null,"前の日を見る",-1))]),_:1})):de("",!0)]),_:1})],4)}}}),$l=Ie(Al,[["__scopeId","data-v-496e6362"]]),Xt=ke({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:null},nextIcon:{type:Qe,default:"$next"},prevIcon:{type:Qe,default:"$prev"},modeIcon:{type:Qe,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),Rt=we()({name:"VDatePickerControls",props:Xt(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,a){let{emit:v}=a;const s=c(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),t=c(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),m=c(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),u=c(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function n(){v("click:prev")}function i(){v("click:next")}function o(){v("click:year")}function f(){v("click:month")}return Pe(()=>r("div",{class:["v-date-picker-controls"]},[r(Z,{class:"v-date-picker-controls__month-btn","data-testid":"month-btn",disabled:s.value,text:e.text,variant:"text",rounded:!0,onClick:f},null),r(Z,{class:"v-date-picker-controls__mode-btn","data-testid":"year-btn",disabled:t.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:o},null),r(Ka,null,null),r("div",{class:"v-date-picker-controls__month"},[r(Z,{"data-testid":"prev-month",disabled:m.value,icon:e.prevIcon,variant:"text",onClick:n},null),r(Z,{"data-testid":"next-month",disabled:u.value,icon:e.nextIcon,variant:"text",onClick:i},null)])])),{}}}),El=ke({appendIcon:Qe,color:String,header:String,transition:String,onClick:Ca()},"VDatePickerHeader"),Ot=we()({name:"VDatePickerHeader",props:El(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,a){let{emit:v,slots:s}=a;const{backgroundColorClasses:t,backgroundColorStyles:m}=ft(e,"color");function u(){v("click")}function n(){v("click:append")}return Pe(()=>{const i=!!(s.default||e.header),o=!!(s.append||e.appendIcon);return r("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},t.value],style:m.value,onClick:u},[s.prepend&&r("div",{key:"prepend",class:"v-date-picker-header__prepend"},[s.prepend()]),i&&r(jt,{key:"content",name:e.transition},{default:()=>{var f;return[r("div",{key:e.header,class:"v-date-picker-header__content"},[((f=s.default)==null?void 0:f.call(s))??e.header])]}}),o&&r("div",{class:"v-date-picker-header__append"},[s.append?r(at,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var f;return[(f=s.append)==null?void 0:f.call(s)]}}):r(Z,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:n},null)])])}),{}}}),Yl=ke({allowedDates:[Array,Function],disabled:{type:Boolean,default:null},displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Nl(e){const a=Ne(),v=Ce(e,"modelValue",[],S=>Je(S).map(T=>a.date(T))),s=c(()=>e.displayValue?a.date(e.displayValue):v.value.length>0?a.date(v.value[0]):e.min?a.date(e.min):Array.isArray(e.allowedDates)?a.date(e.allowedDates[0]):a.date()),t=Ce(e,"year",void 0,S=>{const T=S!=null?Number(S):a.getYear(s.value);return a.startOfYear(a.setYear(a.date(),T))},S=>a.getYear(S)),m=Ce(e,"month",void 0,S=>{const T=S!=null?Number(S):a.getMonth(s.value),x=a.setYear(a.startOfMonth(a.date()),a.getYear(t.value));return a.setMonth(x,T)},S=>a.getMonth(S)),u=c(()=>e.firstDayOfWeek??e.weekdays[0]),n=c(()=>{const S=Number(e.firstDayOfWeek??0);return e.weekdays.map(T=>(T+S)%7)}),i=c(()=>{const S=a.getWeekArray(m.value,u.value),T=S.flat(),x=6*7;if(e.weeksInMonth==="static"&&T.length<x){const P=T[T.length-1];let y=[];for(let z=1;z<=x-T.length;z++)y.push(a.addDays(P,z)),z%7===0&&(S.push(y),y=[])}return S});function o(S,T){return S.filter(x=>n.value.includes(a.toJsDate(x).getDay())).map((x,P)=>{const y=a.toISO(x),z=!a.isSameMonth(x,m.value),G=a.isSameDay(x,a.startOfMonth(m.value)),j=a.isSameDay(x,a.endOfMonth(m.value)),ee=a.isSameDay(x,m.value);return{date:x,isoDate:y,formatted:a.format(x,"keyboardDate"),year:a.getYear(x),month:a.getMonth(x),isDisabled:q(x),isWeekStart:P%7===0,isWeekEnd:P%7===6,isToday:a.isSameDay(x,T),isAdjacent:z,isHidden:z&&!e.showAdjacentMonths,isStart:G,isSelected:v.value.some(W=>a.isSameDay(x,W)),isEnd:j,isSame:ee,localized:a.format(x,"dayOfMonth")}})}const f=c(()=>{const S=a.startOfWeek(s.value,e.firstDayOfWeek),T=[];for(let P=0;P<=6;P++)T.push(a.addDays(S,P));const x=a.date();return o(T,x)}),p=c(()=>{const S=i.value.flat(),T=a.date();return o(S,T)}),C=c(()=>i.value.map(S=>S.length?Pa(a,S[0]):null));function q(S){if(e.disabled)return!0;const T=a.date(S);return e.min&&a.isAfter(a.date(e.min),T)||e.max&&a.isAfter(T,a.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(x=>a.isSameDay(a.date(x),T)):typeof e.allowedDates=="function"?!e.allowedDates(T):!1}return{displayValue:s,daysInMonth:p,daysInWeek:f,genDays:o,model:v,weeksInMonth:i,weekDays:n,weekNumbers:C}}const Kt=ke({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Ee(Yl(),["displayValue"])},"VDatePickerMonth"),At=we()({name:"VDatePickerMonth",props:Kt(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=k(),{daysInMonth:m,model:u,weekNumbers:n}=Nl(e),i=Ne(),o=$e(),f=$e(),p=$e(!1),C=c(()=>p.value?e.reverseTransition:e.transition);e.multiple==="range"&&u.value.length>0&&(o.value=u.value[0],u.value.length>1&&(f.value=u.value[u.value.length-1]));const q=c(()=>{const P=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return u.value.length>=P});_e(m,(P,y)=>{y&&(p.value=i.isBefore(P[0].date,y[0].date))});function S(P){const y=i.startOfDay(P);if(u.value.length===0?o.value=void 0:u.value.length===1&&(o.value=u.value[0],f.value=void 0),!o.value)o.value=y,u.value=[o.value];else if(f.value)o.value=P,f.value=void 0,u.value=[o.value];else{if(i.isSameDay(y,o.value)){o.value=void 0,u.value=[];return}else i.isBefore(y,o.value)?(f.value=i.endOfDay(o.value),o.value=y):f.value=i.endOfDay(y);const z=i.getDiff(f.value,o.value,"days"),G=[o.value];for(let j=1;j<z;j++){const ee=i.addDays(o.value,j);G.push(ee)}G.push(f.value),u.value=G}}function T(P){const y=u.value.findIndex(z=>i.isSameDay(z,P));if(y===-1)u.value=[...u.value,P];else{const z=[...u.value];z.splice(y,1),u.value=z}}function x(P){e.multiple==="range"?S(P):e.multiple?T(P):u.value=[P]}return()=>r("div",{class:"v-date-picker-month"},[e.showWeek&&r("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&r("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[vt(" ")]),n.value.map(P=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[P]))]),r(jt,{name:C.value},{default:()=>{var P;return[r("div",{ref:t,key:(P=m.value[0].date)==null?void 0:P.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&i.getWeekdays(e.firstDayOfWeek).map(y=>r("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[y])),m.value.map((y,z)=>{const G={props:{onClick:()=>x(y.date)},item:y,i:z};return q.value&&!y.isSelected&&(y.isDisabled=!0),r("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":y.isAdjacent,"v-date-picker-month__day--hide-adjacent":y.isHidden,"v-date-picker-month__day--selected":y.isSelected,"v-date-picker-month__day--week-end":y.isWeekEnd,"v-date-picker-month__day--week-start":y.isWeekStart}],"data-v-date":y.isDisabled?void 0:y.isoDate},[(e.showAdjacentMonths||!y.isAdjacent)&&r(at,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(y.isSelected||y.isToday)&&!y.isDisabled?e.color:void 0,disabled:y.isDisabled,icon:!0,ripple:!1,text:y.localized,variant:y.isDisabled?y.isToday?"outlined":"text":y.isToday&&!y.isSelected?"outlined":"flat",onClick:()=>x(y.date)}}},{default:()=>{var j;return[((j=s.day)==null?void 0:j.call(s,G))??r(Z,G.props,null)]}})])})])]}})])}}),Qt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),$t=we()({name:"VDatePickerMonths",props:Qt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Ne(),m=Ce(e,"modelValue"),u=c(()=>{let n=t.startOfYear(t.date());return e.year&&(n=t.setYear(n,e.year)),zt(12).map(i=>{const o=t.format(n,"monthShort"),f=!!(e.min&&t.isAfter(t.startOfMonth(t.date(e.min)),n)||e.max&&t.isAfter(n,t.startOfMonth(t.date(e.max))));return n=t.getNextMonth(n),{isDisabled:f,text:o,value:i}})});return Ut(()=>{m.value=m.value??t.getMonth(t.date())}),Pe(()=>r("div",{class:"v-date-picker-months",style:{height:Ft(e.height)}},[r("div",{class:"v-date-picker-months__content"},[u.value.map((n,i)=>{var p;const o={active:m.value===i,color:m.value===i?e.color:void 0,disabled:n.isDisabled,rounded:!0,text:n.text,variant:m.value===n.value?"flat":"text",onClick:()=>f(i)};function f(C){if(m.value===C){v("update:modelValue",m.value);return}m.value=C}return((p=s.month)==null?void 0:p.call(s,{month:n,i,props:o}))??r(Z,fe({key:"month"},o),null)})])])),{}}}),Jt=ke({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),Et=we()({name:"VDatePickerYears",props:Jt(),emits:{"update:modelValue":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Ne(),m=Ce(e,"modelValue"),u=c(()=>{const i=t.getYear(t.date());let o=i-100,f=i+52;e.min&&(o=t.getYear(t.date(e.min))),e.max&&(f=t.getYear(t.date(e.max)));let p=t.startOfYear(t.date());return p=t.setYear(p,o),zt(f-o+1,o).map(C=>{const q=t.format(p,"year");return p=t.setYear(p,t.getYear(p)+1),{text:q,value:C}})});Ut(()=>{m.value=m.value??t.getYear(t.date())});const n=Ha();return tt(async()=>{var i;await xe(),(i=n.el)==null||i.scrollIntoView({block:"center"})}),Pe(()=>r("div",{class:"v-date-picker-years",style:{height:Ft(e.height)}},[r("div",{class:"v-date-picker-years__content"},[u.value.map((i,o)=>{var p;const f={ref:m.value===i.value?n:void 0,active:m.value===i.value,color:m.value===i.value?e.color:void 0,rounded:!0,text:i.text,variant:m.value===i.value?"flat":"text",onClick:()=>{if(m.value===i.value){v("update:modelValue",m.value);return}m.value=i.value}};return((p=s.year)==null?void 0:p.call(s,{year:i,i:o,props:f}))??r(Z,fe({key:"month"},f),null)})])])),{}}}),Wl=Qa("v-picker-title"),Zt=ke({color:String,...Fa(),...Ua(),...za(),...La(),...Wa(),...Na(),...Ya(),...Ea(),...$a()},"VSheet"),Yt=we()({name:"VSheet",props:Zt(),setup(e,a){let{slots:v}=a;const{themeClasses:s}=Ma(e),{backgroundColorClasses:t,backgroundColorStyles:m}=ft(Gt(e,"color")),{borderClasses:u}=Va(e),{dimensionStyles:n}=Ba(e),{elevationClasses:i}=Ia(e),{locationStyles:o}=Ra(e),{positionClasses:f}=Oa(e),{roundedClasses:p}=Aa(e);return Pe(()=>r(e.tag,{class:["v-sheet",s.value,t.value,u.value,i.value,f.value,p.value,e.class],style:[m.value,n.value,o.value,e.style]},v)),{}}}),ea=ke({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...Zt()},"VPicker"),Nt=we()({name:"VPicker",props:ea(),setup(e,a){let{slots:v}=a;const{backgroundColorClasses:s,backgroundColorStyles:t}=ft(Gt(e,"color"));return Pe(()=>{const m=Yt.filterProps(e),u=!!(e.title||v.title);return r(Yt,fe(m,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!v.actions},e.class],style:e.style}),{default:()=>{var n;return[!e.hideHeader&&r("div",{key:"header",class:[s.value],style:[t.value]},[u&&r(Wl,{key:"picker-title"},{default:()=>{var i;return[((i=v.title)==null?void 0:i.call(v))??e.title]}}),v.header&&r("div",{class:"v-picker__header"},[v.header()])]),r("div",{class:"v-picker__body"},[(n=v.default)==null?void 0:n.call(v)]),v.actions&&r(at,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[r("div",{class:"v-picker__actions"},[v.actions()])]})]}})}),{}}}),Ll=ke({header:{type:String,default:"$vuetify.datePicker.header"},...Xt(),...Kt({weeksInMonth:"static"}),...Ee(Qt(),["modelValue"]),...Ee(Jt(),["modelValue"]),...ea({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),Wt=we()({name:"VDatePicker",props:Ll(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,a){let{emit:v,slots:s}=a;const t=Ne(),{t:m}=Ga(),u=Ce(e,"modelValue",void 0,b=>Je(b).map(B=>t.date(B)),b=>e.multiple?b:b[0]),n=Ce(e,"viewMode"),i=c(()=>{const b=t.date(e.min);return e.min&&t.isValid(b)?b:null}),o=c(()=>{const b=t.date(e.max);return e.max&&t.isValid(b)?b:null}),f=c(()=>{var Y;const b=t.date();let B=b;return(Y=u.value)!=null&&Y[0]?B=t.date(u.value[0]):i.value&&t.isBefore(b,i.value)?B=i.value:o.value&&t.isAfter(b,o.value)&&(B=o.value),B&&t.isValid(B)?B:b}),p=k(Number(e.month??t.getMonth(t.startOfMonth(f.value)))),C=k(Number(e.year??t.getYear(t.startOfYear(t.setMonth(f.value,p.value))))),q=$e(!1),S=c(()=>e.multiple&&u.value.length>1?m("$vuetify.datePicker.itemsSelected",u.value.length):u.value[0]&&t.isValid(u.value[0])?t.format(t.date(u.value[0]),"normalDateWithWeekday"):m(e.header)),T=c(()=>{let b=t.date();return b=t.setDate(b,1),b=t.setMonth(b,p.value),b=t.setYear(b,C.value),t.format(b,"monthAndYear")}),x=c(()=>`date-picker-header${q.value?"-reverse":""}-transition`),P=c(()=>{if(e.disabled)return!0;const b=[];if(n.value!=="month")b.push("prev","next");else{let B=t.date();if(B=t.startOfMonth(B),B=t.setMonth(B,p.value),B=t.setYear(B,C.value),i.value){const Y=t.addDays(t.startOfMonth(B),-1);t.isAfter(i.value,Y)&&b.push("prev")}if(o.value){const Y=t.addDays(t.endOfMonth(B),1);t.isAfter(Y,o.value)&&b.push("next")}}return b});function y(){p.value<11?p.value++:(C.value++,p.value=0,te(C.value)),W(p.value)}function z(){p.value>0?p.value--:(C.value--,p.value=11,te(C.value)),W(p.value)}function G(){n.value="month"}function j(){n.value=n.value==="months"?"month":"months"}function ee(){n.value=n.value==="year"?"month":"year"}function W(b){n.value==="months"&&j(),v("update:month",b)}function te(b){n.value==="year"&&ee(),v("update:year",b)}return _e(u,(b,B)=>{const Y=Je(B),oe=Je(b);if(!oe.length)return;const ve=t.date(Y[Y.length-1]),ae=t.date(oe[oe.length-1]),le=t.getMonth(ae),L=t.getYear(ae);le!==p.value&&(p.value=le,W(p.value)),L!==C.value&&(C.value=L,te(C.value)),q.value=t.isBefore(ve,ae)}),Pe(()=>{const b=Nt.filterProps(e),B=Rt.filterProps(e),Y=Ot.filterProps(e),oe=At.filterProps(e),ve=Ee($t.filterProps(e),["modelValue"]),ae=Ee(Et.filterProps(e),["modelValue"]),le={header:S.value,transition:x.value};return r(Nt,fe(b,{class:["v-date-picker",`v-date-picker--${n.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var L;return((L=s.title)==null?void 0:L.call(s))??r("div",{class:"v-date-picker__title"},[m(e.title)])},header:()=>s.header?r(at,{defaults:{VDatePickerHeader:{...le}}},{default:()=>{var L;return[(L=s.header)==null?void 0:L.call(s,le)]}}):r(Ot,fe({key:"header"},Y,le,{onClick:n.value!=="month"?G:void 0}),{...s,default:void 0}),default:()=>r(pe,null,[r(Rt,fe(B,{disabled:P.value,text:T.value,"onClick:next":y,"onClick:prev":z,"onClick:month":j,"onClick:year":ee}),null),r(Ja,{hideOnLeave:!0},{default:()=>[n.value==="months"?r($t,fe({key:"date-picker-months"},ve,{modelValue:p.value,"onUpdate:modelValue":[L=>p.value=L,W],min:i.value,max:o.value,year:C.value}),null):n.value==="year"?r(Et,fe({key:"date-picker-years"},ae,{modelValue:C.value,"onUpdate:modelValue":[L=>C.value=L,te],min:i.value,max:o.value}),null):r(At,fe({key:"date-picker-month"},oe,{modelValue:u.value,"onUpdate:modelValue":L=>u.value=L,month:p.value,"onUpdate:month":[L=>p.value=L,W],year:C.value,"onUpdate:year":[L=>C.value=L,te],min:i.value,max:o.value}),null)]})]),actions:s.actions})}),{}}}),zl={class:"route-container"},Ul={class:"timetable-controls"},Fl={class:"timetable-controls__date"},Gl={key:0,class:"timetable-controls-mobile"},jl={class:"timetable-controls-mobile__inner"},ql={class:"timetable-controls-mobile__date"},Xl=100,Kl=Be({__name:"TimeTable",setup(e){Ye();const a=We(),v=k(null),s=ka(),t=c(()=>s.server_settings),m=c(()=>t.value.general.backend==="EDCB"),u=k(!1),n=k(!1),i=k(0);let o=null;function f(){o!==null&&clearTimeout(o),o=window.setTimeout(()=>{i.value++,o=null},Xl)}const p=c(()=>(i.value,ge.isSmartphoneVertical()||ge.isSmartphoneHorizontal()||ge.isTabletVertical())),C=c(()=>(i.value,!ge.isSmartphoneVertical())),q=c(()=>a.date_display_offset),S=k(!1),T=k(null),x=k(null),P=k(null),y=k(!1),z=c(()=>{const H=[],h=a.available_channel_types;for(const V of qt)h.has(V)&&H.push({title:V,value:V});return H}),G=c({get:()=>a.selected_channel_type,set:H=>{a.changeChannelType(H)}}),j=c(()=>{const H=[],h=a.is_36hour_display&&q.value===0;for(let V=4;V<=24;V+=4){const X=V,D=V<=12;H.push({title:`${X.toString().padStart(2,"0")}時`,value:V,...h&&D?{props:{disabled:!0}}:{}})}return H});function ee(){let h=F().hour();return h<4&&(h+=24),Math.floor((h-4)/4)*4+4}const W=k(ee()),te=c(()=>{const H=a.selected_date.add(q.value,"day"),h=H.month()+1,V=H.date(),X=["日","月","火","水","木","金","土"][H.day()];return`${h}/${V} (${X})`}),b=c({get:()=>a.selected_date.toDate(),set:H=>{const h=F(H).hour(4).minute(0).second(0).millisecond(0);a.changeDate(h)}}),B=c(()=>a.can_go_previous_day),Y=c(()=>a.can_go_next_day),oe=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.earliest).startOf("day").toDate()),ve=c(()=>a.date_range===null?void 0:a.getBroadcastDate(a.date_range.latest).endOf("day").toDate());function ae(H){if(a.date_range===null)return!1;const h=F(H),V=a.getBroadcastDate(a.date_range.earliest),X=a.getBroadcastDate(a.date_range.latest);return h.isSameOrAfter(V,"day")&&h.isSameOrBefore(X,"day")}function le(H){a.changeChannelType(H)}function L(H){n.value=!1;const h=F(H).hour(4).minute(0).second(0).millisecond(0);a.changeDate(h)}function _(H){H===null||v.value===null||v.value.scrollToHour(H)}async function R(){await a.goToPreviousDay(),await xe(),v.value!==null&&v.value.scrollToEnd()}async function d(){await a.goToNextDay(),await xe(),v.value!==null&&v.value.scrollToStart()}async function O(){await a.goToCurrentTime(),await xe(),v.value!==null&&v.value.scrollToCurrentTime(!0,!0)}function A(H){const h=Math.floor((H-4)/4)*4+4,V=Math.max(4,Math.min(24,h));W.value=V}function K(H){a.setDateDisplayOffset(H)}async function re(H,h,V){const X=F(V.end_time);if(y.value=X.isBefore(F()),V.reservation!==null){const D=await Ge.fetchReservation(V.reservation.id);D!==null?(T.value=D,x.value=null,P.value=null):(T.value=ce(V,h),x.value=null,P.value=null)}else T.value=ce(V,h),x.value=null,P.value=null;S.value=!0}function ce(H,h){return{id:-1,channel:h,program:H,is_recording_in_progress:!1,recording_availability:"Full",comment:"",scheduled_recording_file_name:"",estimated_recording_file_size:0,record_settings:structuredClone(Pt)}}async function ie(){await a.fetchTimeTableData()}async function ne(){await a.fetchTimeTableData()}async function Se(){await a.fetchTimeTableData()}async function Te(H,h,V){if(F(V.end_time).isBefore(F()))return;if(m.value===!1){ct.warning("録画予約機能は EDCB バックエンド利用時のみ使用できます。");return}if(V.reservation!==null){const He=await Ge.fetchReservation(V.reservation.id);if(He===null)return;const se=structuredClone(He.record_settings);if(se.is_enabled=!se.is_enabled,await Ge.updateReservation(He.id,se)!==null){const ze=se.is_enabled?`録画予約を有効にしました。
番組開始時刻になると自動的に録画が開始されます。`:`録画予約を無効にしました。
番組開始時刻までに再度予約を有効にしない限り、この番組は録画されません。`;ct.success(ze),await a.fetchTimeTableData()}return}await Ge.addReservation(H,structuredClone(Pt))&&(ct.success("録画予約を追加しました。"),await a.fetchTimeTableData())}return tt(async()=>{window.addEventListener("resize",f),await s.fetchServerSettingsOnce(),await a.initialLoad()}),mt(()=>{window.removeEventListener("resize",f),o!==null&&(clearTimeout(o),o=null),a.reset()}),_e(()=>a.selected_date,()=>{a.setDateDisplayOffset(0)}),(H,h)=>{const V=et("Icon"),X=Lt("ftooltip");return E(),Q("div",zl,[r(ya,null,ja({_:2},[p.value?void 0:{name:"timetable-controls",fn:J(()=>[$("div",Ul,[r(je,{class:"timetable-controls__channel-type",variant:"outlined",density:"compact","hide-details":"",items:z.value,modelValue:G.value,"onUpdate:modelValue":[h[0]||(h[0]=D=>G.value=D),le]},null,8,["items","modelValue"]),$("div",Fl,[r(Z,{variant:"flat",icon:"",size:"small",disabled:!B.value,onClick:R},{default:J(()=>[r(V,{icon:"fluent:chevron-left-20-regular",width:"20px"})]),_:1},8,["disabled"]),r(Vt,{modelValue:n.value,"onUpdate:modelValue":h[2]||(h[2]=D=>n.value=D),"close-on-content-click":!1},{activator:J(({props:D})=>[r(Z,fe({variant:"flat",class:"timetable-controls__date-button"},D),{default:J(()=>[vt(De(te.value),1)]),_:1},16)]),default:J(()=>[r(Wt,{modelValue:b.value,"onUpdate:modelValue":[h[1]||(h[1]=D=>b.value=D),L],color:"primary",min:oe.value,max:ve.value,"allowed-dates":ae},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"]),r(Z,{variant:"flat",icon:"",size:"small",disabled:!Y.value,onClick:d},{default:J(()=>[r(V,{icon:"fluent:chevron-right-20-regular",width:"20px"})]),_:1},8,["disabled"])]),r(je,{class:"timetable-controls__time",variant:"outlined",density:"compact","hide-details":"",items:j.value,modelValue:W.value,"onUpdate:modelValue":[h[3]||(h[3]=D=>W.value=D),_]},null,8,["items","modelValue"]),dt((E(),he(Z,{variant:"flat",class:"timetable-controls__now-button",icon:"",onClick:O},{default:J(()=>[r(V,{icon:"fluent:clock-20-regular",width:"22px"})]),_:1})),[[X,"現在時刻に移動",void 0,{bottom:!0}]]),dt((E(),he(Z,{variant:"flat",class:"timetable-controls__settings-button",icon:"",onClick:h[4]||(h[4]=D=>u.value=!0)},{default:J(()=>[r(V,{icon:"fluent:settings-20-regular",width:"22px"})]),_:1})),[[X,"番組表の表示設定",void 0,{bottom:!0}]])])]),key:"0"}]),1024),$("main",null,[r(_a,{"icon-only":C.value},null,8,["icon-only"]),$("div",{class:Ze(["timetable-container",{"timetable-container--loading":Ke(a).is_loading}])},[r(ba),p.value?(E(),Q("div",Gl,[$("div",jl,[r(je,{class:"timetable-controls-mobile__channel-type",variant:"outlined",density:"compact","hide-details":"",items:z.value,modelValue:G.value,"onUpdate:modelValue":[h[5]||(h[5]=D=>G.value=D),le]},null,8,["items","modelValue"]),$("div",ql,[r(Vt,{modelValue:n.value,"onUpdate:modelValue":h[7]||(h[7]=D=>n.value=D),"close-on-content-click":!1},{activator:J(({props:D})=>[r(Z,fe({variant:"flat",class:"timetable-controls-mobile__date-button",size:"small"},D),{default:J(()=>[vt(De(te.value),1)]),_:1},16)]),default:J(()=>[r(Wt,{modelValue:b.value,"onUpdate:modelValue":[h[6]||(h[6]=D=>b.value=D),L],color:"primary",min:oe.value,max:ve.value,"allowed-dates":ae},null,8,["modelValue","min","max"])]),_:1},8,["modelValue"])]),r(je,{class:"timetable-controls-mobile__time",variant:"outlined",density:"compact","hide-details":"",items:j.value,modelValue:W.value,"onUpdate:modelValue":[h[8]||(h[8]=D=>W.value=D),_]},null,8,["items","modelValue"]),r(Z,{variant:"flat",class:"timetable-controls-mobile__now-button",icon:"",size:"small",onClick:O},{default:J(()=>[r(V,{icon:"fluent:clock-20-regular",width:"18px"})]),_:1}),r(Z,{variant:"flat",class:"timetable-controls-mobile__settings-button",icon:"",size:"small",onClick:h[9]||(h[9]=D=>u.value=!0)},{default:J(()=>[r(V,{icon:"fluent:settings-20-regular",width:"18px"})]),_:1})])])):de("",!0),r($l,{ref_key:"timetableGridRef",ref:v,channels:Ke(a).channels_data,is36HourDisplay:Ke(a).is_36hour_display,canGoPreviousDay:B.value,canGoNextDay:Y.value,onTimeSlotChange:A,onDateDisplayOffsetChange:K,onShowProgramDetail:re,onQuickReserve:Te,onGoToNextDay:d,onGoToPreviousDay:R},null,8,["channels","is36HourDisplay","canGoPreviousDay","canGoNextDay"])],2)]),r(Ta,{isOpen:u.value,"onUpdate:isOpen":h[10]||(h[10]=D=>u.value=D)},null,8,["isOpen"]),r(Sa,{modelValue:S.value,"onUpdate:modelValue":h[11]||(h[11]=D=>S.value=D),reservation:T.value,program:x.value,channel:P.value,isPastProgram:y.value,onAdded:ie,onUpdated:ne,onDeleted:Se},null,8,["modelValue","reservation","program","channel","isPastProgram"])])}}}),fn=Ie(Kl,[["__scopeId","data-v-223a2f9f"]]);export{fn as default};
