import{d as I,u as L,a as j,r as P,c as N,o as q,w as W,b as c,e as a,f as r,F as B,g,h as E,i as w,j as t,k as l,v as R,n as C,R as f,_ as z,U as H,P as O,M as A,m as K,l as Z,p as X,q as M,s as $,t as G,x as J,y as U,z as p,A as v,V as Q,B as T}from"./index-D59UPlH_.js";import{S as Y,a as ee}from"./swiper-wwp4IWv2.js";import{H as te,N as se}from"./Navigation-BC3lN-Yd.js";import{_ as ne,V}from"./ssrBoot-5VSid4r3.js";import{C as ae,u as ie}from"./ChannelsStore-DTEnbOnk.js";const oe={key:1,class:"search-box"},re=["placeholder"],le=I({__name:"SPHeaderBar",setup(s){const e=L(),i=j(),u=P(!1),m=P(""),k=P(null),D=N(()=>i.path.startsWith("/videos")||i.path.startsWith("/mylist")||i.path.startsWith("/viewing-history")?"録画番組を検索...":"放送予定の番組を検索..."),F=()=>i.path.startsWith("/videos")||i.path.startsWith("/mylist")||i.path.startsWith("/viewing-history")?"/videos/search":"/tv/search",x=()=>{u.value=!0,setTimeout(()=>{var d;(d=k.value)==null||d.focus()},0)},b=()=>{u.value=!1,m.value=""},y=d=>{if(d.key==="Enter"&&!d.isComposing){if(m.value.trim()){const _=F();e.push(`${_}?query=${encodeURIComponent(m.value.trim())}`)}}else d.key==="Escape"&&b()},S=()=>{i.path.endsWith("/search")&&i.query.query&&(m.value=decodeURIComponent(i.query.query),u.value=!0)};return q(()=>{S()}),W(()=>i.fullPath,S),(d,_)=>{const o=c("router-link"),h=c("Icon");return a(),r("header",{class:C(["header",{"search-active":u.value}])},[u.value?(a(),r("div",oe,[g(t("input",{ref_key:"search_input",ref:k,type:"text",placeholder:D.value,"onUpdate:modelValue":_[0]||(_[0]=n=>m.value=n),onKeydown:y},null,40,re),[[R,m.value]]),g((a(),r("div",{class:"search-box__close",onClick:b},[l(h,{icon:"fluent:dismiss-20-filled",height:"24px"})])),[[f]])])):(a(),r(B,{key:0},[g((a(),E(o,{class:"konomitv-logo",to:"/tv/"},{default:w(()=>_[1]||(_[1]=[t("img",{class:"konomitv-logo__image",src:ne,height:"21"},null,-1)])),_:1})),[[f]]),l(V),g((a(),r("div",{class:"search-button",onClick:x},[l(h,{icon:"fluent:search-20-filled",height:"24px"})])),[[f]])],64))],2)}}}),ue=z(le,[["__scopeId","data-v-4ba64491"]]),de=I({name:"TV-Home",components:{SPHeaderBar:ue,HeaderBar:te,Navigation:se,Swiper:Y,SwiperSlide:ee},data(){return{Utils:Object.freeze(H),ChannelUtils:Object.freeze(ae),ProgramUtils:Object.freeze(O),Message:Object.freeze(A),active_tab_index:0,swiper_instance:null,scroll_abort_controller:new AbortController,is_loading:!0,interval_ids:[]}},computed:{...K(ie,Z)},watch:{active_tab_index(){var s,e;(s=this.swiper_instance)==null||s.updateAutoHeight(),(e=this.swiper_instance)==null||e.slideTo(this.active_tab_index,this.is_loading===!0?0:void 0)}},async mounted(){var e,i;this.settingsStore.settings.pinned_channel_ids.length===0&&(this.active_tab_index=1);const s=60-new Date().getSeconds();this.interval_ids.push(window.setTimeout(()=>{this.channelsStore.update(!0),this.interval_ids.push(window.setInterval(()=>this.channelsStore.update(!0),30*1e3))},s*1e3)),await this.channelsStore.update(),((e=this.channelsStore.channels_list_with_pinned.get("ピン留め"))==null?void 0:e.length)===0&&(this.active_tab_index=1),(i=this.swiper_instance)==null||i.updateAutoHeight(),window.addEventListener("scroll",()=>{var u;(u=this.swiper_instance)==null||u.updateAutoHeight()},{passive:!0,signal:this.scroll_abort_controller.signal}),await H.sleep(.01),this.is_loading=!1},beforeUnmount(){for(const s of this.interval_ids)window.clearInterval(s);this.scroll_abort_controller.abort(),this.scroll_abort_controller=new AbortController},methods:{addPinnedChannel(s){this.settingsStore.settings.pinned_channel_ids=[...this.settingsStore.settings.pinned_channel_ids,s.id],A.show(`${s.name}をピン留めしました。`)},removePinnedChannel(s){var e;this.settingsStore.settings.pinned_channel_ids=this.settingsStore.settings.pinned_channel_ids.filter(i=>i!==s.id),((e=this.channelsStore.channels_list_with_pinned.get("ピン留め"))==null?void 0:e.length)===0&&(this.active_tab_index=1),A.show(`${s.name}のピン留めを外しました。`)},isPinnedChannel(s){return this.settingsStore.settings.pinned_channel_ids.includes(s.id)}}}),ce={class:"route-container"},_e={class:"channels-tab"},he={class:"channel__broadcaster"},pe=["src"],ge={class:"channel__broadcaster-content"},me={class:"channel__broadcaster-name"},ve={class:"channel__broadcaster-status"},fe={class:"ml-1"},we={class:"channel__broadcaster-status-viewers ml-4"},Ce={class:"ml-1"},be=["onClick"],ye={class:"channel__program-present"},Se={class:"channel__program-present-title-wrapper"},Be=["innerHTML"],Ee={class:"channel__program-present-time"},ke=["innerHTML"],De={class:"channel__program-following"},Fe={class:"channel__program-following-title"},xe=["innerHTML"],Pe={class:"channel__program-following-time"},Ae={class:"channel__progressbar"},$e={key:0,class:"pinned-container d-flex justify-center align-center w-100"},He={class:"d-flex justify-center align-center flex-column"},Me={class:"mt-4 text-text-darken-1"},Ue={key:0,class:"channels-list pinned-container d-flex justify-center align-center w-100",style:{"flex-grow":"1"}},Te={class:"floating-button__content"};function Ie(s,e,i,u,m,k){const D=c("HeaderBar"),F=c("Navigation"),x=c("SPHeaderBar"),b=c("router-link"),y=c("Icon"),S=c("SwiperSlide"),d=c("Swiper"),_=X("ftooltip");return a(),r("div",ce,[l(D),t("main",null,[l(F),t("div",{class:C(["channels-container channels-container--home",{"channels-container--loading":s.is_loading}])},[l(x),t("div",_e,[t("div",{class:"channels-tab__buttons",style:M({"--tab-length":Array.from(s.channelsStore.channels_list_with_pinned).length,"--active-tab-index":s.active_tab_index})},[(a(!0),r(B,null,$(Array.from(s.channelsStore.channels_list_with_pinned),([o],h)=>(a(),E(Q,{variant:"flat",class:"channels-tab__button",key:o,onClick:n=>s.active_tab_index=h},{default:w(()=>[p(v(o),1)]),_:2},1032,["onClick"]))),128)),e[4]||(e[4]=t("div",{class:"channels-tab__highlight"},null,-1))],4)]),g(l(d,{class:"channels-list","space-between":32,"auto-height":!0,"touch-start-prevent-default":!1,observer:!0,"observe-parents":!0,onSwiper:e[1]||(e[1]=o=>s.swiper_instance=o),onSlideChange:e[2]||(e[2]=o=>s.active_tab_index=o.activeIndex)},{default:w(()=>[(a(!0),r(B,null,$(Array.from(s.channelsStore.channels_list_with_pinned),([o,h])=>(a(),E(S,{key:o},{default:w(()=>[t("div",{class:C(["channels",`channels--tab-${o} channels--length-${h.length}`])},[(a(!0),r(B,null,$(h,n=>g((a(),E(b,{class:"channel",draggable:"false",key:n.id,to:`/tv/watch/${n.display_channel_id}`},{default:w(()=>[t("div",he,[t("img",{class:"channel__broadcaster-icon",src:`${s.Utils.api_base_url}/channels/${n.id}/logo`},null,8,pe),t("div",ge,[t("span",me,"Ch: "+v(n.channel_number)+" "+v(n.name),1),t("div",ve,[t("div",{class:C(["channel__broadcaster-status-force",`channel__broadcaster-status-force--${s.ChannelUtils.getChannelForceType(n.jikkyo_force)}`])},[e[5]||(e[5]=t("svg",{class:"iconify iconify--fa-solid",width:"10.5px",height:"12px",viewBox:"0 0 448 512"},[t("path",{fill:"currentColor",d:"M323.56 51.2c-20.8 19.3-39.58 39.59-56.22 59.97C240.08 73.62 206.28 35.53 168 0C69.74 91.17 0 209.96 0 281.6C0 408.85 100.29 512 224 512s224-103.15 224-230.4c0-53.27-51.98-163.14-124.44-230.4zm-19.47 340.65C282.43 407.01 255.72 416 226.86 416C154.71 416 96 368.26 96 290.75c0-38.61 24.31-72.63 72.79-130.75c6.93 7.98 98.83 125.34 98.83 125.34l58.63-66.88c4.14 6.85 7.91 13.55 11.27 19.97c27.35 52.19 15.81 118.97-33.43 153.42z"})],-1)),e[6]||(e[6]=t("span",{class:"ml-1"},"勢い:",-1)),t("span",fe,v(n.jikkyo_force??"--"),1),e[7]||(e[7]=t("span",{style:{"margin-left":"3px"}}," コメ/分",-1))],2),t("div",we,[e[8]||(e[8]=t("svg",{class:"iconify iconify--fa-solid",width:"15.75px",height:"14px",viewBox:"0 0 576 512"},[t("path",{fill:"currentColor",d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144a143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79a47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"})],-1)),e[9]||(e[9]=t("span",{class:"ml-1"},"視聴数:",-1)),t("span",Ce,v(n.viewer_count),1)])])]),g((a(),r("div",{class:C(["channel__broadcaster-pin",{"channel__broadcaster-pin--pinned":s.isPinnedChannel(n)}]),onClick:T(ze=>s.isPinnedChannel(n)?s.removePinnedChannel(n):s.addPinnedChannel(n),["prevent","stop"]),onMousedown:e[0]||(e[0]=T(()=>{},["prevent","stop"]))},e[10]||(e[10]=[t("svg",{class:"iconify iconify--fluent",width:"24px",height:"24px",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M13.325 2.617a2 2 0 0 0-3.203.52l-1.73 3.459a1.5 1.5 0 0 1-.784.721l-3.59 1.436a1 1 0 0 0-.335 1.636L6.293 13L3 16.292V17h.707L7 13.706l2.61 2.61a1 1 0 0 0 1.636-.335l1.436-3.59a1.5 1.5 0 0 1 .722-.784l3.458-1.73a2 2 0 0 0 .52-3.203l-4.057-4.057Z"})],-1)]),42,be)),[[f],[_,s.isPinnedChannel(n)?"ピン留めを外す":"ピン留めする"]])]),t("div",ye,[t("div",Se,[t("span",{class:"channel__program-present-title",innerHTML:s.ProgramUtils.decorateProgramInfo(n.program_present,"title")},null,8,Be),t("span",Ee,v(s.ProgramUtils.getProgramTime(n.program_present)),1)]),t("span",{class:"channel__program-present-description",innerHTML:s.ProgramUtils.decorateProgramInfo(n.program_present,"description")},null,8,ke)]),l(V),t("div",De,[t("div",Fe,[e[11]||(e[11]=t("span",{class:"channel__program-following-title-decorate"},"NEXT",-1)),e[12]||(e[12]=t("svg",{class:"channel__program-following-title-icon iconify iconify--fluent",width:"16px",height:"16px",viewBox:"0 0 20 20"},[t("path",{fill:"currentColor",d:"M10.018 5.486a1 1 0 0 1 1.592-.806l5.88 4.311a1.25 1.25 0 0 1 0 2.017l-5.88 4.311a1 1 0 0 1-1.592-.806v-3.16L4.61 15.319a1 1 0 0 1-1.592-.806V5.486A1 1 0 0 1 4.61 4.68l5.408 3.966v-3.16Z"})],-1)),t("span",{class:"channel__program-following-title-text",innerHTML:s.ProgramUtils.decorateProgramInfo(n.program_following,"title")},null,8,xe)]),t("span",Pe,v(s.ProgramUtils.getProgramTime(n.program_following)),1)]),t("div",Ae,[t("div",{class:"channel__progressbar-progress",style:M(`width:${s.ProgramUtils.getProgramProgress(n.program_present)}%;`)},null,4)])]),_:2},1032,["to"])),[[f]])),128)),o==="ピン留め"&&h.length===0?(a(),r("div",$e,[t("div",He,[e[17]||(e[17]=t("h2",null,[p("ピン留めされているチャンネルが"),t("br"),p("ありません。")],-1)),t("div",Me,[e[13]||(e[13]=p("各チャンネルの ")),l(y,{style:{position:"relative",bottom:"-5px"},icon:"fluent:pin-20-filled",width:"22px"}),e[14]||(e[14]=p(" アイコンから、よくみる")),e[15]||(e[15]=t("br",null,null,-1)),e[16]||(e[16]=p("チャンネルをこのタブにピン留めできます。"))]),e[18]||(e[18]=t("div",{class:"mt-2 text-text-darken-1"},[p("チャンネルをピン留めすると、"),t("br"),p("このタブが最初に表示されます。")],-1))])])):U("",!0)],2)]),_:2},1024))),128))]),_:1},512),[[G,Array.from(s.channelsStore.channels_list_with_pinned).length>0]]),Array.from(s.channelsStore.channels_list_with_pinned).length===0?(a(),r("div",Ue,e[19]||(e[19]=[J('<div class="d-flex justify-center align-center flex-column" data-v-4723e81a><h2 data-v-4723e81a>視聴可能なチャンネルが<br class="d-sm-none" data-v-4723e81a>ありません。</h2><div class="mt-4 text-text-darken-1" data-v-4723e81a>前回チャンネルスキャンしたときに<br class="d-sm-none" data-v-4723e81a>受信可能なチャンネルを見つけられませんでした。</div><div class="mt-1 text-text-darken-1" data-v-4723e81a>再度チャンネルスキャンを行ってください。</div></div>',1)]))):U("",!0)],2)]),g((a(),r("div",{class:"floating-button",onClick:e[3]||(e[3]=o=>s.Message.warning("番組表は現在開発中です。"))},[t("div",Te,[l(y,{class:"floating-button__icon",icon:"fluent:calendar-20-regular",width:"26px"}),e[20]||(e[20]=t("div",{class:"floating-button__text"},"番組表",-1))])])),[[f]])])}const We=z(de,[["render",Ie],["__scopeId","data-v-4723e81a"]]);export{We as default};
